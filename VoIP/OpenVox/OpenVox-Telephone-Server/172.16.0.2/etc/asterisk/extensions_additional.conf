;--------------------------------------------------------------------------------;
; Do NOT edit this file as it is auto-generated by FreePBX. All modifications to ;
; this file must be done via the web gui. There are alternative files to make    ;
; custom modifications, details at: http://freepbx.org/configuration_files       ;
;--------------------------------------------------------------------------------;
;

[globals]
INTERCOMCODE = nointercom
CALLFILENAME = ""
DIAL_OPTIONS = trm(new)
TRUNK_OPTIONS = 
DIAL_OUT = 9
FAX = 
FAX_RX = system
FAX_RX_EMAIL = fax@mydomain.com
FAX_RX_FROM = freepbx@gmail.com
INCOMING = group-all
NULL = ""
OPERATOR = 
OPERATOR_XTN = 
PARKNOTIFY = SIP/200
RECORDEXTEN = ""
RINGTIMER = 15
DIRECTORY = both
AFTER_INCOMING = 
IN_OVERRIDE = forcereghours
REGTIME = 7:55-17:05
REGDAYS = mon-fri
DIRECTORY_OPTS = 
DIALOUTIDS = 1
VM_PREFIX = *
VM_OPTS = 
VM_GAIN = 
VM_DDTYPE = u
TIMEFORMAT = kM
TONEZONE = cn
ALLOW_SIP_ANON = no
VMX_CONTEXT = from-internal
VMX_PRI = 1
VMX_TIMEDEST_CONTEXT = 
VMX_TIMEDEST_EXT = dovm
VMX_TIMEDEST_PRI = 1
VMX_LOOPDEST_CONTEXT = 
VMX_LOOPDEST_EXT = dovm
VMX_LOOPDEST_PRI = 1
VMX_OPTS_TIMEOUT = 
VMX_OPTS_LOOP = 
VMX_OPTS_DOVM = 
VMX_TIMEOUT = 2
VMX_REPEAT = 1
VMX_LOOPS = 1
TRANSFER_CONTEXT = from-internal-xfer
MIXMON_FORMAT = wav
MIXMON_DIR = 
MIXMON_POST = 
RECORDING_STATE = ENABLED
ASTETCDIR = /etc/asterisk
ASTMODDIR = /usr/lib/asterisk/modules
ASTVARLIBDIR = /var/lib/asterisk
ASTAGIDIR = /var/lib/asterisk/agi-bin
ASTSPOOLDIR = /var/spool/asterisk
ASTRUNDIR = /var/run/asterisk
ASTLOGDIR = /var/log/asterisk
CWINUSEBUSY = true
AMPMGRUSER = admin
AMPMGRPASS = openvox20!!
AMPDBENGINE = mysql
AMPDBHOST = localhost
AMPDBNAME = asterisk
AMPDBUSER = asteriskuser
AMPDBPASS = openvox20!!
ASTVERSION = 1.8.11.0
ASTCHANDAHDI = 1
OUT_1 = DAHDI/g0
OUTCID_1 = 
OUTMAXCHANS_1 = 
OUTFAIL_1 = 
OUTPREFIX_1 = 
OUTDISABLE_1 = off
OUTKEEPCID_1 = off
FORCEDOUTCID_1 = 
PREFIX_TRUNK_1 = 
OUT_2 = SIP/88888
OUTCID_2 = 
OUTMAXCHANS_2 = 
OUTFAIL_2 = 
OUTPREFIX_2 = 
OUTDISABLE_2 = off
OUTKEEPCID_2 = off
FORCEDOUTCID_2 = 
PREFIX_TRUNK_2 = 
OUT_4 = SIP/8675561828726
OUTCID_4 = 
OUTMAXCHANS_4 = 1
OUTFAIL_4 = 
OUTPREFIX_4 = 
OUTDISABLE_4 = off
OUTKEEPCID_4 = off
FORCEDOUTCID_4 = 
PREFIX_TRUNK_4 = 
OUT_7 = SIP/8899
OUTCID_7 = 
OUTMAXCHANS_7 = 
OUTFAIL_7 = 
OUTPREFIX_7 = 
OUTDISABLE_7 = off
OUTKEEPCID_7 = off
FORCEDOUTCID_7 = 
PREFIX_TRUNK_7 = 
OUT_8 = SIP/8675566630978
OUTCID_8 = 
OUTMAXCHANS_8 = 2
OUTFAIL_8 = 
OUTPREFIX_8 = 
OUTDISABLE_8 = off
OUTKEEPCID_8 = off
FORCEDOUTCID_8 = 
PREFIX_TRUNK_8 = 
OUT_9 = SIP/kamailio
OUTCID_9 = 
OUTMAXCHANS_9 = 
OUTFAIL_9 = 
OUTPREFIX_9 = 
OUTDISABLE_9 = off
OUTKEEPCID_9 = off
FORCEDOUTCID_9 = 
PREFIX_TRUNK_9 = 
#include globals_custom.conf

;end of [globals]

[app-callwaiting-cwoff]
include => app-callwaiting-cwoff-custom
exten => *71,1,Answer
exten => *71,n,Wait(1)
exten => *71,n,Macro(user-callerid,)
exten => *71,n,Noop(Deleting: CW/${AMPUSER} ${DB_DELETE(CW/${AMPUSER})})
exten => *71,n(hook_1),Playback(call-waiting&de-activated)
exten => *71,n,Macro(hangupcall,)

; end of [app-callwaiting-cwoff]


[app-callwaiting-cwon]
include => app-callwaiting-cwon-custom
exten => *70,1,Answer
exten => *70,n,Wait(1)
exten => *70,n,Macro(user-callerid,)
exten => *70,n,Set(DB(CW/${AMPUSER})=ENABLED)
exten => *70,n(hook_1),Playback(call-waiting&activated)
exten => *70,n,Macro(hangupcall,)

; end of [app-callwaiting-cwon]


[app-fmf-toggle]
include => app-fmf-toggle-custom
exten => *21,1,Goto(app-fmf-toggle,s,start)
exten => s,1(start),Answer
exten => s,n,Wait(1)
exten => s,n,Macro(user-callerid,)
exten => s,n,GotoIf($["${DB(AMPUSER/${AMPUSER}/followme/ddial)}" = "EXTENSION"]?activate)
exten => s,n,GotoIf($["${DB(AMPUSER/${AMPUSER}/followme/ddial)}" = "DIRECT"]?deactivate:end)
exten => s,n(deactivate),Set(DB(AMPUSER/${AMPUSER}/followme/ddial)=EXTENSION)
exten => s,n(hook_off),Playback(followme&de-activated)
exten => s,n(end),Macro(hangupcall,)
exten => s,n(activate),Set(DB(AMPUSER/${AMPUSER}/followme/ddial)=DIRECT)
exten => s,n(hook_on),Playback(followme&activated)
exten => s,n,Macro(hangupcall,)

; end of [app-fmf-toggle]


[ext-findmefollow]
include => ext-findmefollow-custom
exten => FM614,1,Goto(614,FM614)
exten => 614,1,GotoIf($[ "${DB(AMPUSER/614/followme/ddial)}" = "EXTENSION" ]?ext-local,614,1)
exten => 614,n(FM614),Macro(user-callerid,)
exten => 614,n,Set(__EXTTOCALL=${EXTEN})
exten => 614,n,GotoIf($["foo${BLKVM_OVERRIDE}" = "foo"]?skipdb)
exten => 614,n,GotoIf($["${DB(${BLKVM_OVERRIDE})}" = "TRUE"]?skipov)
exten => 614,n(skipdb),Set(__NODEST=)
exten => 614,n,Set(__BLKVM_OVERRIDE=BLKVM/${EXTEN}/${CHANNEL})
exten => 614,n,Set(__BLKVM_BASE=${EXTEN})
exten => 614,n,Set(DB(${BLKVM_OVERRIDE})=TRUE)
exten => 614,n(skipov),Set(RRNODEST=${NODEST})
exten => 614,n(skipvmblk),Set(__NODEST=${EXTEN})
exten => 614,n,GosubIf($[${DB_EXISTS(AMPUSER/614/followme/changecid)} = 1 & "${DB(AMPUSER/614/followme/changecid)}" != "default" & "${DB(AMPUSER/614/followme/changecid)}" != ""]?sub-fmsetcid,s,1)
exten => 614,n,Set(RecordMethod=Group)
exten => 614,n,Macro(record-enable,${DB(AMPUSER/614/followme/grplist)}-614,${RecordMethod})
exten => 614,n(skipsimple),Set(RingGroupMethod=ringallv2)
exten => 614,n,Set(_FMGRP=614)
exten => 614,n(DIALGRP),GotoIf($[ "${DB(AMPUSER/614/followme/grpconf)}" = "ENABLED" ]?doconfirm)
exten => 614,n,Macro(dial,$[ ${DB(AMPUSER/614/followme/grptime)} + ${DB(AMPUSER/614/followme/prering)} ],${DIAL_OPTIONS},${DB(AMPUSER/614/followme/grplist)})
exten => 614,n,Goto(nextstep)
exten => 614,n(doconfirm),Macro(dial-confirm,$[ ${DB(AMPUSER/614/followme/grptime)} + ${DB(AMPUSER/614/followme/prering)} ],${DIAL_OPTIONS},${DB(AMPUSER/614/followme/grplist)},614)
exten => 614,n(nextstep),Set(RingGroupMethod=)
exten => 614,n,GotoIf($["foo${RRNODEST}" != "foo"]?nodest)
exten => 614,n,Set(__NODEST=)
exten => 614,n,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 614,n,Goto(app-blackhole,hangup,1)
exten => 614,n(nodest),Noop(SKIPPING DEST, CALL CAME FROM Q/RG: ${RRNODEST})

; end of [ext-findmefollow]


[fmgrps]
include => fmgrps-custom
exten => _RG-614-.,1,Macro(dial,${DB(AMPUSER/614/followme/grptime)},M(confirm^^^614)${DIAL_OPTIONS},${EXTEN:7})

; end of [fmgrps]


[sub-fmsetcid]
include => sub-fmsetcid-custom
exten => s,1,Goto(s-${DB(AMPUSER/${EXTTOCALL}/followme/changecid)},1)
exten => s-fixed,1,ExecIf($["${REGEX("^[\+]?[0-9]+$" ${DB(AMPUSER/${EXTTOCALL}/followme/fixedcid)})}" = "1"]?Set(__TRUNKCIDOVERRIDE=${DB(AMPUSER/${EXTTOCALL}/followme/fixedcid)}))
exten => s-fixed,n,Return()
exten => s-extern,1,ExecIf($["${REGEX("^[\+]?[0-9]+$" ${DB(AMPUSER/${EXTTOCALL}/followme/fixedcid)})}" == "1" & "${FROM_DID}" != ""]?Set(__TRUNKCIDOVERRIDE=${DB(AMPUSER/${EXTTOCALL}/followme/fixedcid)}))
exten => s-extern,n,Return()
exten => s-did,1,ExecIf($["${REGEX("^[\+]?[0-9]+$" ${FROM_DID})}" = "1"]?Set(__REALCALLERIDNUM=${FROM_DID}))
exten => s-did,n,Return()
exten => s-forcedid,1,ExecIf($["${REGEX("^[\+]?[0-9]+$" ${FROM_DID})}" = "1"]?Set(__TRUNKCIDOVERRIDE=${FROM_DID}))
exten => s-forcedid,n,Return()
exten => _s-.,1,Noop(Unknown value for AMPUSER/${EXTTOCALL}/followme/changecid of ${DB(AMPUSER/${EXTTOCALL}/followme/changecid)} set to "default")
exten => _s-.,n,Set(DB(AMPUSER/${EXTTOCALL}/followme/changecid)=default)
exten => _s-.,n,Return()

; end of [sub-fmsetcid]


[app-dictate-record]
include => app-dictate-record-custom
exten => *34,1,Answer
exten => *34,n,Macro(user-callerid,)
exten => *34,n,Noop(CallerID is ${AMPUSER})
exten => *34,n,Set(DICTENABLED=${DB(AMPUSER/${AMPUSER}/dictate/enabled)})
exten => *34,n,GotoIf($[$["x${DICTENABLED}"="x"]|$["x${DICTENABLED}"="xdisabled"]]?nodict:dictok)
exten => *34,n(nodict),Playback(feature-not-avail-line)
exten => *34,n,Hangup
exten => *34,n(dictok),Dictate(/var/lib/asterisk/sounds/dictate/${AMPUSER})
exten => *34,n,Macro(hangupcall,)

; end of [app-dictate-record]


[app-dictate-send]
include => app-dictate-send-custom
exten => *35,1,Answer
exten => *35,n,Macro(user-callerid,)
exten => *35,n,Noop(CallerID is ${AMPUSER})
exten => *35,n,Set(DICTENABLED=${DB(AMPUSER/${AMPUSER}/dictate/enabled)})
exten => *35,n,GotoIf($[$["x${DICTENABLED}"="x"]|$["x${DICTENABLED}"="xdisabled"]]?nodict:dictok)
exten => *35,n(nodict),Playback(feature-not-avail-line)
exten => *35,n,Hangup
exten => *35,n(dictok),Read(DICTFILE,enter-filename-short,,,,)
exten => *35,n,Set(DICTEMAIL=${DB(AMPUSER/${AMPUSER}/dictate/email)})
exten => *35,n,Set(DICTFMT=${DB(AMPUSER/${AMPUSER}/dictate/format)})
exten => *35,n,Set(NAME=${DB(AMPUSER/${AMPUSER}/cidname)})
exten => *35,n,Playback(dictation-being-processed)
exten => *35,n,System(/var/lib/asterisk/bin/audio-email.pl --file /var/lib/asterisk/sounds/dictate/${AMPUSER}/${DICTFILE}.raw --attachment dict-${DICTFILE} --format ${DICTFMT} --to ${DICTEMAIL} --subject "Dictation from ${NAME} Attached")
exten => *35,n,Playback(dictation-sent)
exten => *35,n,Macro(hangupcall,)

; end of [app-dictate-send]


[cidlookup]
include => cidlookup-custom
exten => cidlookup_return,1,ExecIf($["${DB(cidname/${CALLERID(num)})}" != ""]?Set(CALLERID(name)=${DB(cidname/${CALLERID(num)})}))
exten => cidlookup_return,n,Return()

; end of [cidlookup]


[macro-outisbusy]
include => macro-outisbusy-custom
exten => s,1,Progress
exten => s,n,GotoIf($["${EMERGENCYROUTE}" = "YES"]?emergency,1)
exten => s,n,GotoIf($["${INTRACOMPANYROUTE}" = "YES"]?intracompany,1)
exten => s,n,Playback(all-circuits-busy-now&pls-try-call-later, noanswer)
exten => s,n,Congestion(20)
exten => s,n,Hangup
exten => intracompany,1,Playback(all-circuits-busy-now&pls-try-call-later, noanswer)
exten => intracompany,n,Congestion(20)
exten => intracompany,n,Hangup
exten => emergency,1,Playback(all-circuits-busy-now&pls-try-call-later)
exten => emergency,n,Congestion(20)
exten => emergency,n,Hangup

; end of [macro-outisbusy]


[app-dnd-off]
include => app-dnd-off-custom
exten => *79,1,Answer
exten => *79,n,Wait(1)
exten => *79,n,Macro(user-callerid,)
exten => *79,n,Noop(Deleting: DND/${AMPUSER} ${DB_DELETE(DND/${AMPUSER})})
exten => *79,n(hook_1),Playback(do-not-disturb&de-activated)
exten => *79,n,Macro(hangupcall,)

; end of [app-dnd-off]


[app-dnd-on]
include => app-dnd-on-custom
exten => *78,1,Answer
exten => *78,n,Wait(1)
exten => *78,n,Macro(user-callerid,)
exten => *78,n,Set(DB(DND/${AMPUSER})=YES)
exten => *78,n(hook_1),Playback(do-not-disturb&activated)
exten => *78,n,Macro(hangupcall,)

; end of [app-dnd-on]


[app-dnd-toggle]
include => app-dnd-toggle-custom
exten => *76,1,Answer
exten => *76,n,Wait(1)
exten => *76,n,Macro(user-callerid,)
exten => *76,n,GotoIf($["${DB(DND/${AMPUSER})}" = ""]?activate:deactivate)
exten => *76,n(activate),Set(DB(DND/${AMPUSER})=YES)
exten => *76,n(hook_on),Playback(do-not-disturb&activated)
exten => *76,n,Macro(hangupcall,)
exten => *76,n(deactivate),Noop(Deleting: DND/${AMPUSER} ${DB_DELETE(DND/${AMPUSER})})
exten => *76,n(hook_off),Playback(do-not-disturb&de-activated)
exten => *76,n,Macro(hangupcall,)

; end of [app-dnd-toggle]


[ext-meetme]
include => ext-meetme-custom
exten => STARTMEETME,1,ExecIf($["${MEETME_MUSIC}" != ""]?Set(CHANNEL(musicclass)=${MEETME_MUSIC}))
exten => STARTMEETME,n,Set(GROUP(meetme)=${MEETME_ROOMNUM})
exten => STARTMEETME,n,GotoIf($[${MAX_PARTICIPANTS} > 0 && ${GROUP_COUNT(${MEETME_ROOMNUM}@meetme)}>${MAX_PARTICIPANTS}]?MEETMEFULL,1)
exten => STARTMEETME,n,MeetMe(${MEETME_ROOMNUM},${MEETME_OPTS},${PIN})
exten => STARTMEETME,n,Hangup
exten => MEETMEFULL,1,Playback(im-sorry&conf-full&goodbye)
exten => MEETMEFULL,n,Hangup
exten => h,1,Hangup
exten => 789,1,Macro(user-callerid,)
exten => 789,n,Set(MEETME_ROOMNUM=789)
exten => 789,n,Set(MAX_PARTICIPANTS=0)
exten => 789,n,Set(MEETME_MUSIC=${MOHCLASS})
exten => 789,n,GotoIf($["${DIALSTATUS}" = "ANSWER"]?USER)
exten => 789,n,Answer
exten => 789,n,Wait(1)
exten => 789,n(USER),Set(MEETME_OPTS=cM)
exten => 789,n,Goto(STARTMEETME,1)

; end of [ext-meetme]


[ext-fax]
include => ext-fax-custom
exten => s,1,Macro(user-callerid,)
exten => s,n,Noop(Receiving Fax for: ${FAX_RX_EMAIL} , From: ${CALLERID(all)})
exten => s,n(receivefax),StopPlaytones
exten => s,n,ReceiveFAX(${ASTSPOOLDIR}/fax/${UNIQUEID}.tif,f)
exten => s,n,ExecIf($["${FAXOPT(error)}"=""]?Set(FAXSTATUS=FAILED LICENSE EXCEEDED))
exten => s,n,ExecIf($["${FAXOPT(error)}"!="" && "${FAXOPT(error)}"!="NO_ERROR"]?Set(FAXSTATUS="FAILED FAXOPT: error: ${FAXOPT(error)} status: ${FAXOPT(status)} statusstr: ${FAXOPT(statusstr)}"))
exten => s,n,Hangup
exten => h,1,GotoIf($["${FAXSTATUS:0:6}" = "FAILED"]?failed)
exten => h,n(process),GotoIf($[${LEN(${FAX_RX_EMAIL})} = 0]?end)
exten => h,n,System(${ASTVARLIBDIR}/bin/fax-process.pl --to "${FAX_RX_EMAIL}" --from "freepbx@gmail.com" --dest "${FROM_DID}" --subject "New fax from ${URIENCODE(${CALLERID(name)})} ${URIENCODE(<${CALLERID(number)}>)}" --attachment fax_${URIENCODE(${CALLERID(number)})}.pdf --type application/pdf --file ${ASTSPOOLDIR}/fax/${UNIQUEID}.tif)
exten => h,n(end),Macro(hangupcall,)
exten => h,process+101(failed),Noop(FAX ${FAXSTATUS} for: ${FAX_RX_EMAIL} , From: ${CALLERID(all)})
exten => h,n,Macro(hangupcall,)

; end of [ext-fax]


[app-fax]
include => app-fax-custom
exten => 666,1,Set(FAX_RX_EMAIL=fax@mydomain.com)
exten => 666,n,Goto(ext-fax,s,1)
exten => h,1,Macro(hangupcall,)

; end of [app-fax]


[ext-did-0001]
include => ext-did-0001-custom
exten => fax,1,Goto(${CUT(FAX_DEST,^,1)},${CUT(FAX_DEST,^,2)},${CUT(FAX_DEST,^,3)})
exten => s,1,Set(__FROM_DID=${EXTEN})
exten => s,n,Gosub(app-blacklist-check,s,1)
exten => s,n,ExecIf($[ "${CALLERID(name)}" = "" ] ?Set(CALLERID(name)=${CALLERID(num)}))
exten => s,n,Set(__CALLINGPRES_SV=${CALLERPRES()})
exten => s,n,Set(CALLERPRES()=allowed_not_screened)
exten => s,n(dest-ext),Goto(ivr-5,s,1)

; end of [ext-did-0001]


[ext-did-0002]
include => ext-did-0002-custom
exten => fax,1,Goto(${CUT(FAX_DEST,^,1)},${CUT(FAX_DEST,^,2)},${CUT(FAX_DEST,^,3)})

; end of [ext-did-0002]


[ivr-3]
include => ivr-3-custom
include => from-did-direct-ivr
exten => fax,1,Goto(${CUT(FAX_DEST,^,1)},${CUT(FAX_DEST,^,2)},${CUT(FAX_DEST,^,3)})
exten => h,1,Hangup
exten => s,1,Set(MSG=custom/chinese_ivr)
exten => s,n,Set(LOOPCOUNT=0)
exten => s,n,Set(__DIR-CONTEXT=)
exten => s,n,Set(_IVR_CONTEXT_${CONTEXT}=${IVR_CONTEXT})
exten => s,n,Set(_IVR_CONTEXT=${CONTEXT})
exten => s,n,GotoIf($["${CDR(disposition)}" = "ANSWERED"]?begin)
exten => s,n,Answer
exten => s,n,Wait(1)
exten => s,n(begin),Set(TIMEOUT(digit)=3)
exten => s,n,Set(TIMEOUT(response)=10)
exten => s,n,Set(__IVR_RETVM=)
exten => s,n,ExecIf($["${MSG}" != ""]?Background(${MSG}))
exten => s,n,WaitExten(,)
exten => hang,1,Playback(vm-goodbye)
exten => hang,n,Hangup
exten => 0,1,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 0,n,Set(__NODEST=)
exten => 0,n,Goto(from-did-direct,819,1)
exten => 1,1,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 1,n,Set(__NODEST=)
exten => 1,n,Goto(ext-group,100,1)
exten => 2,1,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 2,n,Set(__NODEST=)
exten => 2,n,Goto(ext-group,101,1)
exten => 3,1,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 3,n,Set(__NODEST=)
exten => 3,n,Goto(ext-group,102,1)
exten => 4,1,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 4,n,Set(__NODEST=)
exten => 4,n,Goto(ext-group,104,1)
exten => i,1,Set(MSG=custom/invild-cn)
exten => i,n,Goto(loop,1)
exten => t,1,Set(MSG=custom/invild-cn)
exten => t,n,Goto(loop,1)
exten => loop,1,Set(LOOPCOUNT=$[${LOOPCOUNT} + 1])
exten => loop,n,GotoIf($[${LOOPCOUNT} > 3]?hang,1)
exten => loop,n,Goto(ivr-3,s,begin)
exten => return,1,Set(MSG=custom/chinese_ivr)
exten => return,n,Set(_IVR_CONTEXT=${CONTEXT})
exten => return,n,Set(_IVR_CONTEXT_${CONTEXT}=${IVR_CONTEXT_${CONTEXT}})
exten => return,n,Goto(ivr-3,s,begin)

; end of [ivr-3]


[ivr-4]
include => ivr-4-custom
include => from-did-direct-ivr
exten => fax,1,Goto(${CUT(FAX_DEST,^,1)},${CUT(FAX_DEST,^,2)},${CUT(FAX_DEST,^,3)})
exten => h,1,Hangup
exten => s,1,Set(MSG=custom/English-ivr)
exten => s,n,Set(LOOPCOUNT=0)
exten => s,n,Set(__DIR-CONTEXT=)
exten => s,n,Set(_IVR_CONTEXT_${CONTEXT}=${IVR_CONTEXT})
exten => s,n,Set(_IVR_CONTEXT=${CONTEXT})
exten => s,n,GotoIf($["${CDR(disposition)}" = "ANSWERED"]?begin)
exten => s,n,Answer
exten => s,n,Wait(1)
exten => s,n(begin),Set(TIMEOUT(digit)=3)
exten => s,n,Set(TIMEOUT(response)=10)
exten => s,n,Set(__IVR_RETVM=)
exten => s,n,ExecIf($["${MSG}" != ""]?Background(${MSG}))
exten => s,n,WaitExten(,)
exten => hang,1,Playback(vm-goodbye)
exten => hang,n,Hangup
exten => 0,1,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 0,n,Set(__NODEST=)
exten => 0,n,Goto(from-did-direct,819,1)
exten => 1,1,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 1,n,Set(__NODEST=)
exten => 1,n,Goto(ext-group,100,1)
exten => 2,1,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 2,n,Set(__NODEST=)
exten => 2,n,Goto(ext-group,101,1)
exten => 3,1,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 3,n,Set(__NODEST=)
exten => 3,n,Goto(ext-group,103,1)
exten => 4,1,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 4,n,Set(__NODEST=)
exten => 4,n,Goto(ext-group,105,1)
exten => i,1,Set(MSG=custom/invild-en)
exten => i,n,Goto(loop,1)
exten => t,1,Set(MSG=custom/invild-en)
exten => t,n,Goto(loop,1)
exten => loop,1,Set(LOOPCOUNT=$[${LOOPCOUNT} + 1])
exten => loop,n,GotoIf($[${LOOPCOUNT} > 3]?hang,1)
exten => loop,n,Goto(ivr-4,s,begin)
exten => return,1,Set(MSG=custom/English-ivr)
exten => return,n,Set(_IVR_CONTEXT=${CONTEXT})
exten => return,n,Set(_IVR_CONTEXT_${CONTEXT}=${IVR_CONTEXT_${CONTEXT}})
exten => return,n,Goto(ivr-4,s,begin)

; end of [ivr-4]


[ivr-5]
include => ivr-5-custom
include => from-did-direct-ivr
exten => fax,1,Goto(${CUT(FAX_DEST,^,1)},${CUT(FAX_DEST,^,2)},${CUT(FAX_DEST,^,3)})
exten => h,1,Hangup
exten => s,1,Set(MSG=custom/firstcall-1)
exten => s,n,Set(LOOPCOUNT=0)
exten => s,n,Set(__DIR-CONTEXT=)
exten => s,n,Set(_IVR_CONTEXT_${CONTEXT}=${IVR_CONTEXT})
exten => s,n,Set(_IVR_CONTEXT=${CONTEXT})
exten => s,n,GotoIf($["${CDR(disposition)}" = "ANSWERED"]?begin)
exten => s,n,Answer
exten => s,n,Wait(1)
exten => s,n(begin),Set(TIMEOUT(digit)=3)
exten => s,n,Set(TIMEOUT(response)=10)
exten => s,n,Set(__IVR_RETVM=)
exten => s,n,ExecIf($["${MSG}" != ""]?Background(${MSG}))
exten => s,n,WaitExten(,)
exten => hang,1,Playback(vm-goodbye)
exten => hang,n,Hangup
exten => 1,1,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 1,n,Set(__NODEST=)
exten => 1,n,Goto(ivr-3,s,1)
exten => 2,1,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 2,n,Set(__NODEST=)
exten => 2,n,Goto(ivr-4,s,1)
exten => 8,1,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 8,n,Set(__NODEST=)
exten => 8,n,Goto(ext-meetme,789,1)
exten => i,1,Set(MSG=custom/invild-en)
exten => i,n,Goto(loop,1)
exten => t,1,Set(MSG=custom/invild-en)
exten => t,n,Goto(loop,1)
exten => loop,1,Set(LOOPCOUNT=$[${LOOPCOUNT} + 1])
exten => loop,n,GotoIf($[${LOOPCOUNT} > 3]?hang,1)
exten => loop,n,Goto(ivr-5,s,begin)
exten => return,1,Set(MSG=custom/firstcall-1)
exten => return,n,Set(_IVR_CONTEXT=${CONTEXT})
exten => return,n,Set(_IVR_CONTEXT_${CONTEXT}=${IVR_CONTEXT_${CONTEXT}})
exten => return,n,Goto(ivr-5,s,begin)

; end of [ivr-5]


[app-gabcast]
include => app-gabcast-custom
exten => *422,1,Macro(user-callerid,)
exten => *422,n,Goto(gabcast,${AMPUSER},1)

; end of [app-gabcast]


[gabcast]
include => gabcast-custom
exten => _X.,1,Dial(IAX2/iax.gabcast.com/422,120,tr)
exten => s,1,Dial(IAX2/iax.gabcast.com/422,120,tr)

; end of [gabcast]


[app-recordings]
include => app-recordings-custom
exten => *77,1,Macro(user-callerid,)
exten => *77,n,Wait(2)
exten => *77,n,Macro(systemrecording,dorecord)
exten => *99,1,Macro(user-callerid,)
exten => *99,n,Wait(2)
exten => *99,n,Macro(systemrecording,docheck)

; end of [app-recordings]


[macro-systemrecording]
include => macro-systemrecording-custom
exten => s,1,Set(RECFILE=${IF($["${ARG2}" = ""]?/var/spool/asterisk/tmp/${AMPUSER}-ivrrecording:${ARG2})})
exten => s,n,ExecIf($["${ARG3}" != ""]?Authenticate(${ARG3}))
exten => s,n,Goto(${ARG1},1)
exten => dorecord,1,System(rm ${ASTVARLIBDIR}/sounds/${RECFILE}.*)
exten => dorecord,n,Record(${RECFILE}:wav)
exten => dorecord,n,Wait(1)
exten => dorecord,n,Goto(confmenu,1)
exten => docheck,1,Playback(beep)
exten => docheck,n(dc_start),Background(${RECFILE},m,${CHANNEL(language)},macro-systemrecording)
exten => docheck,n,Wait(1)
exten => docheck,n,Goto(confmenu,1)
exten => confmenu,1,Background(to-listen-to-it&press-1&to-rerecord-it&press-star&astcc-followed-by-pound,m,${CHANNEL(language)},macro-systemrecording)
exten => confmenu,n,Read(RECRESULT,,1,,,4)
exten => confmenu,n,GotoIf($["x${RECRESULT}"="x*"]?dorecord,1)
exten => confmenu,n,GotoIf($["x${RECRESULT}"="x1"]?docheck,2)
exten => confmenu,n,Goto(1)
exten => 1,1,Goto(docheck,dc_start)
exten => *,1,Goto(dorecord,1)
exten => t,1,Playback(goodbye)
exten => t,n,Hangup
exten => i,1,Playback(pm-invalid-option)
exten => i,n,Goto(confmenu,1)
exten => h,1,Hangup

; end of [macro-systemrecording]


[macro-speeddial-lookup]
include => macro-speeddial-lookup-custom
exten => s,1,GotoIf($["${ARG2}"=""]]?lookupsys)
exten => s,n,Set(SPEEDDIALNUMBER=)
exten => s,n(lookupuser),Set(SPEEDDIALNUMBER=${DB(AMPUSER/${ARG2}/speeddials/${ARG1})})
exten => s,n,GotoIf($["${SPEEDDIALNUMBER}"=""]?lookupsys)
exten => s,n,Noop(Found speeddial ${ARG1} for user ${ARG2}: ${SPEEDDIALNUMBER})
exten => s,n,Goto(end)
exten => s,lookupuser+101(lookupsys),Set(SPEEDDIALNUMBER=${DB(sysspeeddials/${ARG1})})
exten => s,n,GotoIf($["${SPEEDDIALNUMBER}"=""]?failed)
exten => s,n,Noop(Found system speeddial ${ARG1}: ${SPEEDDIALNUMBER})
exten => s,n,Goto(end)
exten => s,lookupsys+101(failed),Noop(No system or user speeddial found)
exten => s,n(end),Noop(End of Speeddial-lookup)

; end of [macro-speeddial-lookup]


[app-speeddial]
include => app-speeddial-custom
exten => _*0.,1,Macro(user-callerid,)
exten => _*0.,n,Set(SPEEDDIALLOCATION=${EXTEN:2})
exten => _*0.,n(lookup),Macro(speeddial-lookup,${SPEEDDIALLOCATION},${AMPUSER})
exten => _*0.,n,GotoIf($["${SPEEDDIALNUMBER}"=""]?failed)
exten => _*0.,n,Goto(from-internal,${SPEEDDIALNUMBER},1)
exten => _*0.,lookup+101(failed),Playback(speed-dial-empty)
exten => _*0.,n,Congestion()
exten => *75,1,Goto(app-speeddial-set,s,1)

; end of [app-speeddial]


[app-speeddial-set]
include => app-speeddial-set-custom
exten => s,1,Macro(user-callerid,)
exten => s,n(setloc),Read(newlocation,speed-enterlocation,,,,)
exten => s,n(lookup),Macro(speeddial-lookup,${newlocation},${AMPUSER})
exten => s,n(lookup),GotoIf($["${SPEEDDIALNUMBER}"!=""]?conflicts)
exten => s,n(setnum),Read(newnum,speed-enternumber,,,,)
exten => s,n(success),Set(DB(AMPUSER/${AMPUSER}/speeddials/${newlocation})=${newnum})
exten => s,n,Playback(speed-dial)
exten => s,n,SayDigits(${newlocation})
exten => s,n,Playback(is-set-to)
exten => s,n,SayDigits(${newnum})
exten => s,n,Hangup
exten => s,n(conflicts),Playback(speed-dial)
exten => s,n,SayDigits(${newlocation})
exten => s,n,Playback(is-in-use)
exten => s,n,Background(press-1&to-listen-to-it&press-2&to-enter-a-diff&location&press-3&to-change&telephone-number)
exten => s,n,WaitExten(60,)
exten => 1,1,Playback(speed-dial)
exten => 1,n,SayDigits(${newlocation})
exten => 1,n,Playback(is-set-to)
exten => 1,n,SayDigits(${SPEEDDIALNUMBER})
exten => 1,n,Goto(s,conflicts)
exten => 2,1,Goto(s,setloc)
exten => 3,1,Goto(s,setnum)
exten => t,1,Congestion()

; end of [app-speeddial-set]


[app-cf-busy-off]
include => app-cf-busy-off-custom
exten => *91,1,Answer
exten => *91,n,Wait(1)
exten => *91,n,Macro(user-callerid,)
exten => *91,n,Set(fromext=${AMPUSER})
exten => *91,n,Noop(Deleting: CFB/${fromext} ${DB_DELETE(CFB/${fromext})})
exten => *91,n(hook_1),Playback(call-fwd-on-busy&de-activated)
exten => *91,n,Macro(hangupcall,)
exten => _*91.,1,Answer
exten => _*91.,n,Wait(1)
exten => _*91.,n,Set(fromext=${EXTEN:3})
exten => _*91.,n,Noop(Deleting: CFB/${fromext} ${DB_DELETE(CFB/${fromext})})
exten => _*91.,n(hook_2),Playback(call-fwd-on-busy&for&extension)
exten => _*91.,n,SayDigits(${fromext})
exten => _*91.,n,Playback(cancelled)
exten => _*91.,n,Macro(hangupcall,)

; end of [app-cf-busy-off]


[app-cf-busy-off-any]
include => app-cf-busy-off-any-custom
exten => *92,1,Answer
exten => *92,n,Macro(user-callerid,)
exten => *92,n,Wait(1)
exten => *92,n,Read(fromext,please-enter-your&extension&then-press-pound,,,,)
exten => *92,n,Set(fromext=${IF($["foo${fromext}"="foo"]?${AMPUSER}:${fromext})})
exten => *92,n,Wait(1)
exten => *92,n,Noop(Deleting: CFB/${fromext} ${DB_DELETE(CFB/${fromext})})
exten => *92,n(hook_1),Playback(call-fwd-on-busy&for&extension)
exten => *92,n,SayDigits(${fromext})
exten => *92,n,Playback(cancelled)
exten => *92,n,Macro(hangupcall,)

; end of [app-cf-busy-off-any]


[app-cf-busy-on]
include => app-cf-busy-on-custom
exten => *90,1,Answer
exten => *90,n,Wait(1)
exten => *90,n,Macro(user-callerid,)
exten => *90,n,Read(fromext,call-fwd-on-busy&please-enter-your&extension&then-press-pound,,,,)
exten => *90,n,Set(fromext=${IF($["foo${fromext}"="foo"]?${AMPUSER}:${fromext})})
exten => *90,n,Wait(1)
exten => *90,n(startread),Read(toext,ent-target-attendant&then-press-pound,,,,)
exten => *90,n,GotoIf($["foo${toext}"="foo"]?startread)
exten => *90,n,Wait(1)
exten => *90,n,Set(DB(CFB/${fromext})=${toext})
exten => *90,n(hook_1),Playback(call-fwd-on-busy&for&extension)
exten => *90,n,SayDigits(${fromext})
exten => *90,n,Playback(is-set-to)
exten => *90,n,SayDigits(${toext})
exten => *90,n,Macro(hangupcall,)
exten => _*90.,1,Answer
exten => _*90.,n,Wait(1)
exten => _*90.,n,Macro(user-callerid,)
exten => _*90.,n,Set(fromext=${AMPUSER})
exten => _*90.,n,Set(toext=${EXTEN:3})
exten => _*90.,n,Set(DB(CFB/${fromext})=${toext})
exten => _*90.,n(hook_2),Playback(call-fwd-on-busy&for&extension)
exten => _*90.,n,SayDigits(${fromext})
exten => _*90.,n,Playback(is-set-to)
exten => _*90.,n,SayDigits(${toext})
exten => _*90.,n,Macro(hangupcall,)

; end of [app-cf-busy-on]


[app-cf-off]
include => app-cf-off-custom
exten => *73,1,Answer
exten => *73,n,Wait(1)
exten => *73,n,Macro(user-callerid,)
exten => *73,n,Set(fromext=${AMPUSER})
exten => *73,n,Noop(Deleting: CF/${fromext} ${DB_DELETE(CF/${fromext})})
exten => *73,n(hook_1),Playback(call-fwd-unconditional&de-activated)
exten => *73,n,Macro(hangupcall,)
exten => _*73.,1,Answer
exten => _*73.,n,Wait(1)
exten => _*73.,n,Set(fromext=${EXTEN:3})
exten => _*73.,n,Noop(Deleting: CF/${fromext} ${DB_DELETE(CF/${fromext})})
exten => _*73.,n(hook_2),Playback(call-fwd-unconditional&for&extension)
exten => _*73.,n,SayDigits(${fromext})
exten => _*73.,n,Playback(cancelled)
exten => _*73.,n,Macro(hangupcall,)

; end of [app-cf-off]


[app-cf-off-any]
include => app-cf-off-any-custom
exten => *74,1,Answer
exten => *74,n,Macro(user-callerid,)
exten => *74,n,Wait(1)
exten => *74,n,Read(fromext,please-enter-your&extension&then-press-pound,,,,)
exten => *74,n,Set(fromext=${IF($["foo${fromext}"="foo"]?${AMPUSER}:${fromext})})
exten => *74,n,Wait(1)
exten => *74,n,Noop(Deleting: CF/${fromext} ${DB_DELETE(CF/${fromext})})
exten => *74,n(hook_1),Playback(call-fwd-unconditional&for&extension)
exten => *74,n,SayDigits(${fromext})
exten => *74,n,Playback(cancelled)
exten => *74,n,Macro(hangupcall,)

; end of [app-cf-off-any]


[app-cf-on]
include => app-cf-on-custom
exten => *72,1,Answer
exten => *72,n,Wait(1)
exten => *72,n,Macro(user-callerid,)
exten => *72,n,Read(fromext,call-fwd-unconditional&please-enter-your&extension&then-press-pound,,,,)
exten => *72,n,Set(fromext=${IF($["foo${fromext}"="foo"]?${AMPUSER}:${fromext})})
exten => *72,n,Wait(1)
exten => *72,n(startread),Read(toext,ent-target-attendant&then-press-pound,,,,)
exten => *72,n,GotoIf($["foo${toext}"="foo"]?startread)
exten => *72,n,Wait(1)
exten => *72,n,Set(DB(CF/${fromext})=${toext})
exten => *72,n(hook_1),Playback(call-fwd-unconditional&for&extension)
exten => *72,n,SayDigits(${fromext})
exten => *72,n,Playback(is-set-to)
exten => *72,n,SayDigits(${toext})
exten => *72,n,Macro(hangupcall,)
exten => _*72.,1,Answer
exten => _*72.,n,Wait(1)
exten => _*72.,n,Macro(user-callerid,)
exten => _*72.,n,Set(fromext=${AMPUSER})
exten => _*72.,n,Set(toext=${EXTEN:3})
exten => _*72.,n,Set(DB(CF/${fromext})=${toext})
exten => _*72.,n(hook_2),Playback(call-fwd-unconditional&for&extension)
exten => _*72.,n,SayDigits(${fromext})
exten => _*72.,n,Playback(is-set-to)
exten => _*72.,n,SayDigits(${toext})
exten => _*72.,n,Macro(hangupcall,)

; end of [app-cf-on]


[app-cf-unavailable-off]
include => app-cf-unavailable-off-custom
exten => *53,1,Answer
exten => *53,n,Wait(1)
exten => *53,n,Macro(user-callerid,)
exten => *53,n,Set(fromext=${AMPUSER})
exten => *53,n,Noop(Deleting: CFU/${fromext} ${DB_DELETE(CFU/${fromext})})
exten => *53,n(hook_1),Playback(call-fwd-no-ans&de-activated)
exten => *53,n,Macro(hangupcall,)
exten => _*53.,1,Answer
exten => _*53.,n,Wait(1)
exten => _*53.,n,Set(fromext=${EXTEN:3})
exten => _*53.,n,Noop(Deleting: CFU/${fromext} ${DB_DELETE(CFU/${fromext})})
exten => _*53.,n(hook_2),Playback(call-fwd-no-ans&for&extension)
exten => _*53.,n,SayDigits(${fromext})
exten => _*53.,n,Playback(cancelled)
exten => _*53.,n,Macro(hangupcall,)

; end of [app-cf-unavailable-off]


[app-cf-unavailable-on]
include => app-cf-unavailable-on-custom
exten => *52,1,Answer
exten => *52,n,Wait(1)
exten => *52,n,Macro(user-callerid,)
exten => *52,n,Read(fromext,call-fwd-no-ans&please-enter-your&extension&then-press-pound,,,,)
exten => *52,n,Set(fromext=${IF($["foo${fromext}"="foo"]?${AMPUSER}:${fromext})})
exten => *52,n,Wait(1)
exten => *52,n(startread),Read(toext,ent-target-attendant&then-press-pound,,,,)
exten => *52,n,GotoIf($["foo${toext}"="foo"]?startread)
exten => *52,n,Wait(1)
exten => *52,n,Set(DB(CFU/${fromext})=${toext})
exten => *52,n(hook_1),Playback(call-fwd-no-ans&for&extension)
exten => *52,n,SayDigits(${fromext})
exten => *52,n,Playback(is-set-to)
exten => *52,n,SayDigits(${toext})
exten => *52,n,Macro(hangupcall,)
exten => _*52.,1,Answer
exten => _*52.,n,Wait(1)
exten => _*52.,n,Macro(user-callerid,)
exten => _*52.,n,Set(fromext=${AMPUSER})
exten => _*52.,n,Set(toext=${EXTEN:3})
exten => _*52.,n,Set(DB(CFU/${fromext})=${toext})
exten => _*52.,n(hook_2),Playback(call-fwd-no-ans&for&extension)
exten => _*52.,n,SayDigits(${fromext})
exten => _*52.,n,Playback(is-set-to)
exten => _*52.,n,SayDigits(${toext})
exten => _*52.,n,Macro(hangupcall,)

; end of [app-cf-unavailable-on]


[app-cf-toggle]
include => app-cf-toggle-custom
exten => *740,1,Answer
exten => *740,n,Wait(1)
exten => *740,n,Macro(user-callerid,)
exten => *740,n,Set(fromext=${AMPUSER})
exten => *740,n,GotoIf($["${DB(CF/${fromext})}" = ""]?activate:deactivate)
exten => *740,n(activate),Read(toext,ent-target-attendant&then-press-pound,,,,)
exten => *740,n,GotoIf($["${toext}"=""]?activate)
exten => *740,n,Wait(1)
exten => *740,n(toext),Set(DB(CF/${fromext})=${toext})
exten => *740,n(hook_on),Playback(call-fwd-unconditional&for&extension)
exten => *740,n,SayDigits(${fromext})
exten => *740,n,Playback(is-set-to)
exten => *740,n,SayDigits(${toext})
exten => *740,n,Macro(hangupcall,)
exten => *740,n(setdirect),Answer
exten => *740,n,Wait(1)
exten => *740,n,Macro(user-callerid,)
exten => *740,n,Goto(toext)
exten => *740,n(deactivate),Noop(Deleting: CF/${fromext} ${DB_DELETE(CF/${fromext})})
exten => *740,n(hook_off),Playback(call-fwd-unconditional&de-activated)
exten => *740,n,Macro(hangupcall,)

; end of [app-cf-toggle]


[app-pbdirectory]
include => app-pbdirectory-custom
exten => 411,1,Goto(pbdirectory,1)
exten => pbdirectory,1,Answer
exten => pbdirectory,n,Wait(1)
exten => pbdirectory,n,Macro(user-callerid,)
exten => pbdirectory,n,AGI(pbdirectory)
exten => pbdirectory,n,GotoIf($["${dialnumber}"=""]?hangup,1)
exten => pbdirectory,n,Noop(Got number to dial: ${dialnumber})
exten => pbdirectory,n,Dial(Local/${dialnumber}@from-internal/n,)
exten => hangup,1,Hangup

; end of [app-pbdirectory]


[app-dialvm]
include => app-dialvm-custom
exten => *98,1,Answer
exten => *98,n(start),Wait(1)
exten => *98,n,Noop(app-dialvm: Asking for mailbox)
exten => *98,n,Read(MAILBOX,vm-login,,,3,2)
exten => *98,n(check),Noop(app-dialvm: Got Mailbox ${MAILBOX})
exten => *98,n,Macro(get-vmcontext,${MAILBOX})
exten => *98,n,Set(VMBOXEXISTSSTATUS=${IF(${MAILBOX_EXISTS(${MAILBOX}@${VMCONTEXT})}?SUCCESS:FAILED)})
exten => *98,n,GotoIf($["${VMBOXEXISTSSTATUS}" = "SUCCESS"]?good:bad)
exten => *98,n,Macro(hangupcall,)
exten => *98,n(good),Noop(app-dialvm: Good mailbox ${MAILBOX}@${VMCONTEXT})
exten => *98,n,VoiceMailMain(${MAILBOX}@${VMCONTEXT})
exten => *98,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?playret)
exten => *98,n,Macro(hangupcall,)
exten => *98,n(bad),Noop(app-dialvm: BAD mailbox ${MAILBOX}@${VMCONTEXT})
exten => *98,n,Wait(1)
exten => *98,n,Noop(app-dialvm: Asking for password so people can't probe for existence of a mailbox)
exten => *98,n,Read(FAKEPW,vm-password,,,3,2)
exten => *98,n,Noop(app-dialvm: Asking for mailbox again)
exten => *98,n,Read(MAILBOX,vm-incorrect-mailbox,,,3,2)
exten => *98,n,Goto(check)
exten => *98,n,Macro(hangupcall,)
exten => *98,n(playret),Playback(beep&you-will-be-transfered-menu&silence/1)
exten => *98,n,Goto(${IVR_CONTEXT},return,1)
exten => _*98.,1,Answer
exten => _*98.,n,Wait(1)
exten => _*98.,n,Macro(get-vmcontext,${EXTEN:3})
exten => _*98.,n,VoiceMailMain(${EXTEN:3}@${VMCONTEXT})
exten => _*98.,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?${IVR_CONTEXT},return,1)
exten => _*98.,n,Macro(hangupcall,)

; end of [app-dialvm]


[app-vmmain]
include => app-vmmain-custom
exten => *97,1,Answer
exten => *97,n,Wait(1)
exten => *97,n,Macro(user-callerid,)
exten => *97,n,Macro(get-vmcontext,${AMPUSER})
exten => *97,n(check),Set(VMBOXEXISTSSTATUS=${IF(${MAILBOX_EXISTS(${AMPUSER}@${VMCONTEXT})}?SUCCESS:FAILED)})
exten => *97,n,GotoIf($["${VMBOXEXISTSSTATUS}" = "SUCCESS"]?mbexist)
exten => *97,n,VoiceMailMain()
exten => *97,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?playret)
exten => *97,n,Macro(hangupcall,)
exten => *97,check+101(mbexist),VoiceMailMain(${AMPUSER}@${VMCONTEXT})
exten => *97,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?playret)
exten => *97,n,Macro(hangupcall,)
exten => *97,n(playret),Playback(beep&you-will-be-transfered-menu&silence/1)
exten => *97,n,Goto(${IVR_CONTEXT},return,1)

; end of [app-vmmain]


[ext-group]
include => ext-group-custom
exten => 100,1,Macro(user-callerid,)
exten => 100,n,GotoIf($["foo${BLKVM_OVERRIDE}" = "foo"]?skipdb)
exten => 100,n,GotoIf($["${DB(${BLKVM_OVERRIDE})}" = "TRUE"]?skipov)
exten => 100,n(skipdb),Set(__NODEST=)
exten => 100,n,Set(__BLKVM_OVERRIDE=BLKVM/${EXTEN}/${CHANNEL})
exten => 100,n,Set(__BLKVM_BASE=${EXTEN})
exten => 100,n,Set(DB(${BLKVM_OVERRIDE})=TRUE)
exten => 100,n(skipov),Set(RRNODEST=${NODEST})
exten => 100,n(skipvmblk),Set(__NODEST=${EXTEN})
exten => 100,n,GosubIf($[${DB_EXISTS(RINGGROUP/100/changecid)} = 1 & "${DB(RINGGROUP/100/changecid)}" != "default" & "${DB(RINGGROUP/100/changecid)}" != ""]?sub-rgsetcid,s,1)
exten => 100,n,Set(RecordMethod=Group)
exten => 100,n,Macro(record-enable,603-621,${RecordMethod})
exten => 100,n,Set(RingGroupMethod=ringall)
exten => 100,n,GotoIf($["foo${RRNODEST}" != "foo"]?DIALGRP)
exten => 100,n,Answer
exten => 100,n,Wait(1)
exten => 100,n,Playback(custom/luyin)
exten => 100,n(DIALGRP),Macro(dial,15,m(new)tm(new),603-621)
exten => 100,n,Set(RingGroupMethod=)
exten => 100,n,GotoIf($["foo${RRNODEST}" != "foo"]?nodest)
exten => 100,n,Set(__NODEST=)
exten => 100,n,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 100,n,Goto(ext-local,vmu603,1)
exten => 100,n(nodest),Noop(SKIPPING DEST, CALL CAME FROM Q/RG: ${RRNODEST})
exten => 101,1,Macro(user-callerid,)
exten => 101,n,GotoIf($["foo${BLKVM_OVERRIDE}" = "foo"]?skipdb)
exten => 101,n,GotoIf($["${DB(${BLKVM_OVERRIDE})}" = "TRUE"]?skipov)
exten => 101,n(skipdb),Set(__NODEST=)
exten => 101,n,Set(__BLKVM_OVERRIDE=BLKVM/${EXTEN}/${CHANNEL})
exten => 101,n,Set(__BLKVM_BASE=${EXTEN})
exten => 101,n,Set(DB(${BLKVM_OVERRIDE})=TRUE)
exten => 101,n(skipov),Set(RRNODEST=${NODEST})
exten => 101,n(skipvmblk),Set(__NODEST=${EXTEN})
exten => 101,n,GosubIf($[${DB_EXISTS(RINGGROUP/101/changecid)} = 1 & "${DB(RINGGROUP/101/changecid)}" != "default" & "${DB(RINGGROUP/101/changecid)}" != ""]?sub-rgsetcid,s,1)
exten => 101,n,Set(RecordMethod=Group)
exten => 101,n,Macro(record-enable,605-819,${RecordMethod})
exten => 101,n,Set(RingGroupMethod=ringall)
exten => 101,n,GotoIf($["foo${RRNODEST}" != "foo"]?DIALGRP)
exten => 101,n,Answer
exten => 101,n,Wait(1)
exten => 101,n,Playback(custom/luyin)
exten => 101,n(DIALGRP),Macro(dial,20,m(new)tm(new),605-819)
exten => 101,n,Set(RingGroupMethod=)
exten => 101,n,GotoIf($["foo${RRNODEST}" != "foo"]?nodest)
exten => 101,n,Set(__NODEST=)
exten => 101,n,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 101,n,Goto(app-blackhole,hangup,1)
exten => 101,n(nodest),Noop(SKIPPING DEST, CALL CAME FROM Q/RG: ${RRNODEST})
exten => 102,1,Macro(user-callerid,)
exten => 102,n,GotoIf($["foo${BLKVM_OVERRIDE}" = "foo"]?skipdb)
exten => 102,n,GotoIf($["${DB(${BLKVM_OVERRIDE})}" = "TRUE"]?skipov)
exten => 102,n(skipdb),Set(__NODEST=)
exten => 102,n,Set(__BLKVM_OVERRIDE=BLKVM/${EXTEN}/${CHANNEL})
exten => 102,n,Set(__BLKVM_BASE=${EXTEN})
exten => 102,n,Set(DB(${BLKVM_OVERRIDE})=TRUE)
exten => 102,n(skipov),Set(RRNODEST=${NODEST})
exten => 102,n(skipvmblk),Set(__NODEST=${EXTEN})
exten => 102,n,GosubIf($[${DB_EXISTS(RINGGROUP/102/changecid)} = 1 & "${DB(RINGGROUP/102/changecid)}" != "default" & "${DB(RINGGROUP/102/changecid)}" != ""]?sub-rgsetcid,s,1)
exten => 102,n,Set(RecordMethod=Group)
exten => 102,n,Macro(record-enable,651-653-654-655-656-652,${RecordMethod})
exten => 102,n,Set(RingGroupMethod=memoryhunt)
exten => 102,n,GotoIf($["foo${RRNODEST}" != "foo"]?DIALGRP)
exten => 102,n,Answer
exten => 102,n,Wait(1)
exten => 102,n,Playback(custom/luyin)
exten => 102,n(DIALGRP),Macro(dial,10,m(new)tm(new),651-653-654-655-656-652)
exten => 102,n,Set(RingGroupMethod=)
exten => 102,n,GotoIf($["foo${RRNODEST}" != "foo"]?nodest)
exten => 102,n,Set(__NODEST=)
exten => 102,n,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 102,n,Goto(app-blackhole,hangup,1)
exten => 102,n(nodest),Noop(SKIPPING DEST, CALL CAME FROM Q/RG: ${RRNODEST})
exten => 103,1,Macro(user-callerid,)
exten => 103,n,GotoIf($["foo${BLKVM_OVERRIDE}" = "foo"]?skipdb)
exten => 103,n,GotoIf($["${DB(${BLKVM_OVERRIDE})}" = "TRUE"]?skipov)
exten => 103,n(skipdb),Set(__NODEST=)
exten => 103,n,Set(__BLKVM_OVERRIDE=BLKVM/${EXTEN}/${CHANNEL})
exten => 103,n,Set(__BLKVM_BASE=${EXTEN})
exten => 103,n,Set(DB(${BLKVM_OVERRIDE})=TRUE)
exten => 103,n(skipov),Set(RRNODEST=${NODEST})
exten => 103,n(skipvmblk),Set(__NODEST=${EXTEN})
exten => 103,n,GosubIf($[${DB_EXISTS(RINGGROUP/103/changecid)} = 1 & "${DB(RINGGROUP/103/changecid)}" != "default" & "${DB(RINGGROUP/103/changecid)}" != ""]?sub-rgsetcid,s,1)
exten => 103,n,Set(RecordMethod=Group)
exten => 103,n,Macro(record-enable,651-653-654-655-656-652,${RecordMethod})
exten => 103,n,Set(RingGroupMethod=ringall)
exten => 103,n,GotoIf($["foo${RRNODEST}" != "foo"]?DIALGRP)
exten => 103,n,Answer
exten => 103,n,Wait(1)
exten => 103,n,Playback(custom/please_hold)
exten => 103,n(DIALGRP),Macro(dial,10,m(new)tm(new),651-653-654-655-656-652)
exten => 103,n,Set(RingGroupMethod=)
exten => 103,n,GotoIf($["foo${RRNODEST}" != "foo"]?nodest)
exten => 103,n,Set(__NODEST=)
exten => 103,n,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 103,n,Goto(app-blackhole,hangup,1)
exten => 103,n(nodest),Noop(SKIPPING DEST, CALL CAME FROM Q/RG: ${RRNODEST})
exten => 104,1,Macro(user-callerid,)
exten => 104,n,GotoIf($["foo${BLKVM_OVERRIDE}" = "foo"]?skipdb)
exten => 104,n,GotoIf($["${DB(${BLKVM_OVERRIDE})}" = "TRUE"]?skipov)
exten => 104,n(skipdb),Set(__NODEST=)
exten => 104,n,Set(__BLKVM_OVERRIDE=BLKVM/${EXTEN}/${CHANNEL})
exten => 104,n,Set(__BLKVM_BASE=${EXTEN})
exten => 104,n,Set(DB(${BLKVM_OVERRIDE})=TRUE)
exten => 104,n(skipov),Set(RRNODEST=${NODEST})
exten => 104,n(skipvmblk),Set(__NODEST=${EXTEN})
exten => 104,n,GosubIf($[${DB_EXISTS(RINGGROUP/104/changecid)} = 1 & "${DB(RINGGROUP/104/changecid)}" != "default" & "${DB(RINGGROUP/104/changecid)}" != ""]?sub-rgsetcid,s,1)
exten => 104,n,Set(RecordMethod=Group)
exten => 104,n,Macro(record-enable,601-602-618-619-616-620-621-606,${RecordMethod})
exten => 104,n,Set(RingGroupMethod=ringall)
exten => 104,n,GotoIf($["foo${RRNODEST}" != "foo"]?DIALGRP)
exten => 104,n,Answer
exten => 104,n,Wait(1)
exten => 104,n,Playback(custom/luyin)
exten => 104,n(DIALGRP),Macro(dial,20,m(new)tm(new),601-602-618-619-616-620-621-606)
exten => 104,n,Set(RingGroupMethod=)
exten => 104,n,GotoIf($["foo${RRNODEST}" != "foo"]?nodest)
exten => 104,n,Set(__NODEST=)
exten => 104,n,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 104,n,Goto(ext-local,vmu618,1)
exten => 104,n(nodest),Noop(SKIPPING DEST, CALL CAME FROM Q/RG: ${RRNODEST})
exten => 105,1,Macro(user-callerid,)
exten => 105,n,GotoIf($["foo${BLKVM_OVERRIDE}" = "foo"]?skipdb)
exten => 105,n,GotoIf($["${DB(${BLKVM_OVERRIDE})}" = "TRUE"]?skipov)
exten => 105,n(skipdb),Set(__NODEST=)
exten => 105,n,Set(__BLKVM_OVERRIDE=BLKVM/${EXTEN}/${CHANNEL})
exten => 105,n,Set(__BLKVM_BASE=${EXTEN})
exten => 105,n,Set(DB(${BLKVM_OVERRIDE})=TRUE)
exten => 105,n(skipov),Set(RRNODEST=${NODEST})
exten => 105,n(skipvmblk),Set(__NODEST=${EXTEN})
exten => 105,n,GosubIf($[${DB_EXISTS(RINGGROUP/105/changecid)} = 1 & "${DB(RINGGROUP/105/changecid)}" != "default" & "${DB(RINGGROUP/105/changecid)}" != ""]?sub-rgsetcid,s,1)
exten => 105,n,Set(RecordMethod=Group)
exten => 105,n,Macro(record-enable,601-602-618-619-616-620-621-606,${RecordMethod})
exten => 105,n,Set(RingGroupMethod=ringall)
exten => 105,n,GotoIf($["foo${RRNODEST}" != "foo"]?DIALGRP)
exten => 105,n,Answer
exten => 105,n,Wait(1)
exten => 105,n,Playback(custom/please_hold)
exten => 105,n(DIALGRP),Macro(dial,20,m(new)tm(new),601-602-618-619-616-620-621-606)
exten => 105,n,Set(RingGroupMethod=)
exten => 105,n,GotoIf($["foo${RRNODEST}" != "foo"]?nodest)
exten => 105,n,Set(__NODEST=)
exten => 105,n,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 105,n,Goto(ext-local,vmu618,1)
exten => 105,n(nodest),Noop(SKIPPING DEST, CALL CAME FROM Q/RG: ${RRNODEST})
exten => h,1,Macro(hangupcall,)

; end of [ext-group]


[sub-rgsetcid]
include => sub-rgsetcid-custom
exten => s,1,Goto(s-${DB(RINGGROUP/${NODEST}/changecid)},1)
exten => s-fixed,1,ExecIf($["${REGEX("^[\+]?[0-9]+$" ${DB(RINGGROUP/${NODEST}/fixedcid)})}" = "1"]?Set(__TRUNKCIDOVERRIDE=${DB(RINGGROUP/${NODEST}/fixedcid)}))
exten => s-fixed,n,Return()
exten => s-extern,1,ExecIf($["${REGEX("^[\+]?[0-9]+$" ${DB(RINGGROUP/${NODEST}/fixedcid)})}" == "1" & "${FROM_DID}" != ""]?Set(__TRUNKCIDOVERRIDE=${DB(RINGGROUP/${NODEST}/fixedcid)}))
exten => s-extern,n,Return()
exten => s-did,1,ExecIf($["${REGEX("^[\+]?[0-9]+$" ${FROM_DID})}" = "1"]?Set(__REALCALLERIDNUM=${FROM_DID}))
exten => s-did,n,Return()
exten => s-forcedid,1,ExecIf($["${REGEX("^[\+]?[0-9]+$" ${FROM_DID})}" = "1"]?Set(__TRUNKCIDOVERRIDE=${FROM_DID}))
exten => s-forcedid,n,Return()
exten => _s-.,1,Noop(Unknown value for RINGGROUP/${NODEST}/changecid of ${DB(RINGGROUP/${NODEST}/changecid)} set to "default")
exten => _s-.,n,Set(DB(RINGGROUP/${NODEST}/changecid)=default)
exten => _s-.,n,Return()

; end of [sub-rgsetcid]


[app-queue-toggle]
include => app-queue-toggle-custom
exten => s,1(start),Answer
exten => s,n,Wait(1)
exten => s,n,Macro(user-callerid,)
exten => s,n,Set(QUEUESTAT=LOGGEDOUT)
exten => s,n,AGI(queue_devstate.agi,getqueues,${AMPUSER})
exten => s,n,GotoIf($["${QUEUESTAT}" = "LOGGEDOUT"]?activate)
exten => s,n,GotoIf($["${QUEUESTAT}" = "LOGGEDIN"]?deactivate)
exten => s,n,GotoIf($["${QUEUESTAT}" = "STATIC"]?static:end)
exten => s,n(deactivate),Noop(Agent Logged out)
exten => s,n,Macro(toggle-del-agent,)
exten => s,n,Playback(agent-loggedoff)
exten => s,n,Macro(hangupcall,)
exten => s,n(activate),Noop(Agent Logged In)
exten => s,n,Macro(toggle-add-agent,)
exten => s,n,Playback(agent-loginok)
exten => s,n,SayDigits(${CALLBACKNUM})
exten => s,n,Macro(hangupcall,)
exten => s,n(static),Noop(User is a Static Agent)
exten => s,n,Playback(agent-loginok)
exten => s,n,Macro(hangupcall,)

; end of [app-queue-toggle]


[macro-toggle-del-agent]
include => macro-toggle-del-agent-custom
exten => s,1,Wait(1)
exten => s,n,Macro(user-callerid,SKIPTTL,)
exten => s,n,Set(CALLBACKNUM=${AMPUSER})
exten => s,n,RemoveQueueMember(${QUEUENO},Local/${CALLBACKNUM}@from-queue/n)
exten => s,n,RemoveQueueMember(${QUEUENO},Local/${CALLBACKNUM}@from-internal/n)
exten => s,n,UserEvent(RefreshQueue)
exten => s,n,MacroExit()

; end of [macro-toggle-del-agent]


[macro-toggle-add-agent]
include => macro-toggle-add-agent-custom
exten => s,1,Wait(1)
exten => s,n,Macro(user-callerid,SKIPTTL,)
exten => s,n,Set(CALLBACKNUM=${AMPUSER})
exten => s,n,GotoIf($["${DB(QPENALTY/${QUEUENO}/dynmemberonly)}" = "yes" & ${DB_EXISTS(QPENALTY/${QUEUENO}/agents/${CALLBACKNUM})} != 1]?invalid)
exten => s,n,AddQueueMember(${QUEUENO},Local/${CALLBACKNUM}@from-queue/n,${DB(QPENALTY/${QUEUENO}/agents/${CALLBACKNUM})},,${DB(AMPUSER/${CALLBACKNUM}/cidname)},${DB(DEVICE/${REALCALLERIDNUM}/dial)})
exten => s,n,UserEvent(AgentLogin,Agent: ${CALLBACKNUM})
exten => s,n,MacroExit()
exten => s,n(invalid),Playback(pbx-invalid)
exten => s,n,MacroExit()

; end of [macro-toggle-add-agent]


[ext-queues]
include => ext-queues-custom
exten => h,1,Macro(hangupcall,)

; end of [ext-queues]


[from-queue]
include => from-queue-custom
exten => _.,1,Set(QAGENT=${EXTEN})
exten => _.,n,Goto(${NODEST},1)

; end of [from-queue]


[from-queue-exten-internal]
include => from-queue-exten-internal-custom
include => from-queue-exten-only
include => from-internal
exten => foo,1,Noop(bar)

; end of [from-queue-exten-internal]


[from-queue-exten-only]
include => from-queue-exten-only-custom
exten => 301,1,Set(RingGroupMethod=none)
exten => 301,n,Macro(record-enable,301,IN)
exten => 301,n,Macro(dial-one,,${DIAL_OPTIONS},301)
exten => 301,n,Hangup
exten => 302,1,Set(RingGroupMethod=none)
exten => 302,n,Macro(record-enable,302,IN)
exten => 302,n,Macro(dial-one,,${DIAL_OPTIONS},302)
exten => 302,n,Hangup
exten => 303,1,Set(RingGroupMethod=none)
exten => 303,n,Macro(record-enable,303,IN)
exten => 303,n,Macro(dial-one,,${DIAL_OPTIONS},303)
exten => 303,n,Hangup
exten => 304,1,Set(RingGroupMethod=none)
exten => 304,n,Macro(record-enable,304,IN)
exten => 304,n,Macro(dial-one,,${DIAL_OPTIONS},304)
exten => 304,n,Hangup
exten => 601,1,Set(RingGroupMethod=none)
exten => 601,n,Macro(record-enable,601,IN)
exten => 601,n,Macro(dial-one,,${DIAL_OPTIONS},601)
exten => 601,n,Hangup
exten => 602,1,Set(RingGroupMethod=none)
exten => 602,n,Macro(record-enable,602,IN)
exten => 602,n,Macro(dial-one,,${DIAL_OPTIONS},602)
exten => 602,n,Hangup
exten => 603,1,Set(RingGroupMethod=none)
exten => 603,n,Macro(record-enable,603,IN)
exten => 603,n,Macro(dial-one,,${DIAL_OPTIONS},603)
exten => 603,n,Hangup
exten => 605,1,Set(RingGroupMethod=none)
exten => 605,n,Macro(record-enable,605,IN)
exten => 605,n,Macro(dial-one,,${DIAL_OPTIONS},605)
exten => 605,n,Hangup
exten => 606,1,Set(RingGroupMethod=none)
exten => 606,n,Macro(record-enable,606,IN)
exten => 606,n,Macro(dial-one,,${DIAL_OPTIONS},606)
exten => 606,n,Hangup
exten => 608,1,Set(RingGroupMethod=none)
exten => 608,n,Macro(record-enable,608,IN)
exten => 608,n,Macro(dial-one,,${DIAL_OPTIONS},608)
exten => 608,n,Hangup
exten => 609,1,Set(RingGroupMethod=none)
exten => 609,n,Macro(record-enable,609,IN)
exten => 609,n,Macro(dial-one,,${DIAL_OPTIONS},609)
exten => 609,n,Hangup
exten => 614,1,Set(RingGroupMethod=none)
exten => 614,n,Macro(record-enable,614,IN)
exten => 614,n,Macro(dial-one,,${DIAL_OPTIONS},614)
exten => 614,n,Hangup
exten => 615,1,Set(RingGroupMethod=none)
exten => 615,n,Macro(record-enable,615,IN)
exten => 615,n,Macro(dial-one,,${DIAL_OPTIONS},615)
exten => 615,n,Hangup
exten => 616,1,Set(RingGroupMethod=none)
exten => 616,n,Macro(record-enable,616,IN)
exten => 616,n,Macro(dial-one,,${DIAL_OPTIONS},616)
exten => 616,n,Hangup
exten => 617,1,Set(RingGroupMethod=none)
exten => 617,n,Macro(record-enable,617,IN)
exten => 617,n,Macro(dial-one,,${DIAL_OPTIONS},617)
exten => 617,n,Hangup
exten => 618,1,Set(RingGroupMethod=none)
exten => 618,n,Macro(record-enable,618,IN)
exten => 618,n,Macro(dial-one,,${DIAL_OPTIONS},618)
exten => 618,n,Hangup
exten => 619,1,Set(RingGroupMethod=none)
exten => 619,n,Macro(record-enable,619,IN)
exten => 619,n,Macro(dial-one,,${DIAL_OPTIONS},619)
exten => 619,n,Hangup
exten => 620,1,Set(RingGroupMethod=none)
exten => 620,n,Macro(record-enable,620,IN)
exten => 620,n,Macro(dial-one,,${DIAL_OPTIONS},620)
exten => 620,n,Hangup
exten => 621,1,Set(RingGroupMethod=none)
exten => 621,n,Macro(record-enable,621,IN)
exten => 621,n,Macro(dial-one,,${DIAL_OPTIONS},621)
exten => 621,n,Hangup
exten => 622,1,Set(RingGroupMethod=none)
exten => 622,n,Macro(record-enable,622,IN)
exten => 622,n,Macro(dial-one,,${DIAL_OPTIONS},622)
exten => 622,n,Hangup
exten => 650,1,Set(RingGroupMethod=none)
exten => 650,n,Macro(record-enable,650,IN)
exten => 650,n,Macro(dial-one,,${DIAL_OPTIONS},650)
exten => 650,n,Hangup
exten => 651,1,Set(RingGroupMethod=none)
exten => 651,n,Macro(record-enable,651,IN)
exten => 651,n,Macro(dial-one,,${DIAL_OPTIONS},651)
exten => 651,n,Hangup
exten => 652,1,Set(RingGroupMethod=none)
exten => 652,n,Macro(record-enable,652,IN)
exten => 652,n,Macro(dial-one,,${DIAL_OPTIONS},652)
exten => 652,n,Hangup
exten => 653,1,Set(RingGroupMethod=none)
exten => 653,n,Macro(record-enable,653,IN)
exten => 653,n,Macro(dial-one,,${DIAL_OPTIONS},653)
exten => 653,n,Hangup
exten => 654,1,Set(RingGroupMethod=none)
exten => 654,n,Macro(record-enable,654,IN)
exten => 654,n,Macro(dial-one,,${DIAL_OPTIONS},654)
exten => 654,n,Hangup
exten => 655,1,Set(RingGroupMethod=none)
exten => 655,n,Macro(record-enable,655,IN)
exten => 655,n,Macro(dial-one,,${DIAL_OPTIONS},655)
exten => 655,n,Hangup
exten => 656,1,Set(RingGroupMethod=none)
exten => 656,n,Macro(record-enable,656,IN)
exten => 656,n,Macro(dial-one,,${DIAL_OPTIONS},656)
exten => 656,n,Hangup
exten => 657,1,Set(RingGroupMethod=none)
exten => 657,n,Macro(record-enable,657,IN)
exten => 657,n,Macro(dial-one,,${DIAL_OPTIONS},657)
exten => 657,n,Hangup
exten => 658,1,Set(RingGroupMethod=none)
exten => 658,n,Macro(record-enable,658,IN)
exten => 658,n,Macro(dial-one,,${DIAL_OPTIONS},658)
exten => 658,n,Hangup
exten => 659,1,Set(RingGroupMethod=none)
exten => 659,n,Macro(record-enable,659,IN)
exten => 659,n,Macro(dial-one,,${DIAL_OPTIONS},659)
exten => 659,n,Hangup
exten => 660,1,Set(RingGroupMethod=none)
exten => 660,n,Macro(record-enable,660,IN)
exten => 660,n,Macro(dial-one,,${DIAL_OPTIONS},660)
exten => 660,n,Hangup
exten => 678,1,Set(RingGroupMethod=none)
exten => 678,n,Macro(record-enable,678,IN)
exten => 678,n,Macro(dial-one,,${DIAL_OPTIONS},678)
exten => 678,n,Hangup
exten => 685,1,Set(RingGroupMethod=none)
exten => 685,n,Macro(record-enable,685,IN)
exten => 685,n,Macro(dial-one,,${DIAL_OPTIONS},685)
exten => 685,n,Hangup
exten => 686,1,Set(RingGroupMethod=none)
exten => 686,n,Macro(record-enable,686,IN)
exten => 686,n,Macro(dial-one,,${DIAL_OPTIONS},686)
exten => 686,n,Hangup
exten => 687,1,Set(RingGroupMethod=none)
exten => 687,n,Macro(record-enable,687,IN)
exten => 687,n,Macro(dial-one,,${DIAL_OPTIONS},687)
exten => 687,n,Hangup
exten => 688,1,Set(RingGroupMethod=none)
exten => 688,n,Macro(record-enable,688,IN)
exten => 688,n,Macro(dial-one,,${DIAL_OPTIONS},688)
exten => 688,n,Hangup
exten => 701,1,Set(RingGroupMethod=none)
exten => 701,n,Macro(record-enable,701,IN)
exten => 701,n,Macro(dial-one,,${DIAL_OPTIONS},701)
exten => 701,n,Hangup
exten => 777,1,Set(RingGroupMethod=none)
exten => 777,n,Macro(record-enable,777,IN)
exten => 777,n,Macro(dial-one,,${DIAL_OPTIONS},777)
exten => 777,n,Hangup
exten => 808,1,Set(RingGroupMethod=none)
exten => 808,n,Macro(record-enable,808,IN)
exten => 808,n,Macro(dial-one,,${DIAL_OPTIONS},808)
exten => 808,n,Hangup
exten => 810,1,Set(RingGroupMethod=none)
exten => 810,n,Macro(record-enable,810,IN)
exten => 810,n,Macro(dial-one,,${DIAL_OPTIONS},810)
exten => 810,n,Hangup
exten => 815,1,Set(RingGroupMethod=none)
exten => 815,n,Macro(record-enable,815,IN)
exten => 815,n,Macro(dial-one,,${DIAL_OPTIONS},815)
exten => 815,n,Hangup
exten => 816,1,Set(RingGroupMethod=none)
exten => 816,n,Macro(record-enable,816,IN)
exten => 816,n,Macro(dial-one,,${DIAL_OPTIONS},816)
exten => 816,n,Hangup
exten => 818,1,Set(RingGroupMethod=none)
exten => 818,n,Macro(record-enable,818,IN)
exten => 818,n,Macro(dial-one,,${DIAL_OPTIONS},818)
exten => 818,n,Hangup
exten => 819,1,Set(RingGroupMethod=none)
exten => 819,n,Macro(record-enable,819,IN)
exten => 819,n,Macro(dial-one,,${DIAL_OPTIONS},819)
exten => 819,n,Hangup
exten => 820,1,Set(RingGroupMethod=none)
exten => 820,n,Macro(record-enable,820,IN)
exten => 820,n,Macro(dial-one,,${DIAL_OPTIONS},820)
exten => 820,n,Hangup
exten => 852,1,Set(RingGroupMethod=none)
exten => 852,n,Macro(record-enable,852,IN)
exten => 852,n,Macro(dial-one,,${DIAL_OPTIONS},852)
exten => 852,n,Hangup
exten => 853,1,Set(RingGroupMethod=none)
exten => 853,n,Macro(record-enable,853,IN)
exten => 853,n,Macro(dial-one,,${DIAL_OPTIONS},853)
exten => 853,n,Hangup
exten => 855,1,Set(RingGroupMethod=none)
exten => 855,n,Macro(record-enable,855,IN)
exten => 855,n,Macro(dial-one,,${DIAL_OPTIONS},855)
exten => 855,n,Hangup
exten => 856,1,Set(RingGroupMethod=none)
exten => 856,n,Macro(record-enable,856,IN)
exten => 856,n,Macro(dial-one,,${DIAL_OPTIONS},856)
exten => 856,n,Hangup
exten => 857,1,Set(RingGroupMethod=none)
exten => 857,n,Macro(record-enable,857,IN)
exten => 857,n,Macro(dial-one,,${DIAL_OPTIONS},857)
exten => 857,n,Hangup
exten => 858,1,Set(RingGroupMethod=none)
exten => 858,n,Macro(record-enable,858,IN)
exten => 858,n,Macro(dial-one,,${DIAL_OPTIONS},858)
exten => 858,n,Hangup
exten => 859,1,Set(RingGroupMethod=none)
exten => 859,n,Macro(record-enable,859,IN)
exten => 859,n,Macro(dial-one,,${DIAL_OPTIONS},859)
exten => 859,n,Hangup
exten => 861,1,Set(RingGroupMethod=none)
exten => 861,n,Macro(record-enable,861,IN)
exten => 861,n,Macro(dial-one,,${DIAL_OPTIONS},861)
exten => 861,n,Hangup
exten => 862,1,Set(RingGroupMethod=none)
exten => 862,n,Macro(record-enable,862,IN)
exten => 862,n,Macro(dial-one,,${DIAL_OPTIONS},862)
exten => 862,n,Hangup
exten => 863,1,Set(RingGroupMethod=none)
exten => 863,n,Macro(record-enable,863,IN)
exten => 863,n,Macro(dial-one,,${DIAL_OPTIONS},863)
exten => 863,n,Hangup
exten => 886,1,Set(RingGroupMethod=none)
exten => 886,n,Macro(record-enable,886,IN)
exten => 886,n,Macro(dial-one,,${DIAL_OPTIONS},886)
exten => 886,n,Hangup
exten => 919,1,Set(RingGroupMethod=none)
exten => 919,n,Macro(record-enable,919,IN)
exten => 919,n,Macro(dial-one,,${DIAL_OPTIONS},919)
exten => 919,n,Hangup
exten => 978,1,Set(RingGroupMethod=none)
exten => 978,n,Macro(record-enable,978,IN)
exten => 978,n,Macro(dial-one,,${DIAL_OPTIONS},978)
exten => 978,n,Hangup
exten => 999,1,Set(RingGroupMethod=none)
exten => 999,n,Macro(record-enable,999,IN)
exten => 999,n,Macro(dial-one,,${DIAL_OPTIONS},999)
exten => 999,n,Hangup
exten => 8888,1,Set(RingGroupMethod=none)
exten => 8888,n,Macro(record-enable,8888,IN)
exten => 8888,n,Macro(dial-one,,${DIAL_OPTIONS},8888)
exten => 8888,n,Hangup
exten => h,1,Macro(hangupcall,)

; end of [from-queue-exten-only]


[macro-agent-add]
include => macro-agent-add-custom
exten => s,1,Wait(1)
exten => s,n,Macro(user-callerid,SKIPTTL)
exten => s,n(a3),Read(CALLBACKNUM,agent-login,,,,)
exten => s,n,GotoIf($[${LEN(${CALLBACKNUM})}=0]?a5:a7)
exten => s,n(a5),Set(CALLBACKNUM=${IF($[${LEN(${AMPUSER})}=0]?${CALLERID(number)}:${AMPUSER})})
exten => s,n,Set(THISDEVICE=${DB(DEVICE/${REALCALLERIDNUM}/dial)})
exten => s,n,GotoIf($["${CALLBACKNUM}" = ""]?a3)
exten => s,n(a7),GotoIf($["${CALLBACKNUM}" = "${ARG1}"]?invalid)
exten => s,n,GotoIf($["${ARG3}" = "EXTEN" & ${DB_EXISTS(AMPUSER/${CALLBACKNUM}/cidname)} = 0]?invalid)
exten => s,n,GotoIf($["${DB(QPENALTY/${ARG1}/dynmemberonly)}" = "yes" & ${DB_EXISTS(QPENALTY/${ARG1}/agents/${CALLBACKNUM})} != 1]?invalid)
exten => s,n,ExecIf($["${QREGEX}" != ""]?GotoIf($["${REGEX("${QREGEX}" ${CALLBACKNUM})}" = "0"]?invalid))
exten => s,n,ExecIf($["${ARG2}" != ""]?Authenticate(${ARG2}))
exten => s,n,Set(THISDEVICE=${IF($[${LEN(${THISDEVICE})}=0]?${DB(DEVICE/${CUT(DB(AMPUSER/${CALLBACKNUM}/device),&,1)}/dial)}:${THISDEVICE})})
exten => s,n,ExecIf($[${LEN(${THISDEVICE})}!=0]?AddQueueMember(${ARG1},Local/${CALLBACKNUM}@from-queue/n,${DB(QPENALTY/${ARG1}/agents/${CALLBACKNUM})},,${DB(AMPUSER/${CALLBACKNUM}/cidname)},${THISDEVICE}))
exten => s,n,ExecIf($[${LEN(${THISDEVICE})}=0]?AddQueueMember(${ARG1},Local/${CALLBACKNUM}@from-queue/n,${DB(QPENALTY/${ARG1}/agents/${CALLBACKNUM})}))
exten => s,n,UserEvent(Agentlogin,Agent: ${CALLBACKNUM})
exten => s,n,Wait(1)
exten => s,n,Playback(agent-loginok&with&extension)
exten => s,n,SayDigits(${CALLBACKNUM})
exten => s,n,Hangup
exten => s,n,MacroExit()
exten => s,n(invalid),Playback(pbx-invalid)
exten => s,n,Goto(a3)

; end of [macro-agent-add]


[macro-agent-del]
include => macro-agent-del-custom
exten => s,1,Wait(1)
exten => s,n,Macro(user-callerid,SKIPTTL)
exten => s,n(a3),Read(CALLBACKNUM,agent-logoff,,,,)
exten => s,n,GotoIf($[${LEN(${CALLBACKNUM})}=0]?a5:a7)
exten => s,n(a5),Set(CALLBACKNUM=${IF($[${LEN(${AMPUSER})}=0]?${CALLERID(number)}:${AMPUSER})})
exten => s,n,GotoIf($["${CALLBACKNUM}" = ""]?a3)
exten => s,n(a7),RemoveQueueMember(${ARG1},Local/${CALLBACKNUM}@from-queue/n)
exten => s,n,RemoveQueueMember(${ARG1},Local/${CALLBACKNUM}@from-internal/n)
exten => s,n,UserEvent(RefreshQueue)
exten => s,n,Wait(1)
exten => s,n,Playback(agent-loggedoff)
exten => s,n,Hangup

; end of [macro-agent-del]


[macro-autoanswer]
include => macro-autoanswer-custom
exten => s,1,Set(DIAL=${DB(DEVICE/${ARG1}/dial)})
exten => s,n,ExecIf($["${DIAL:0:3}" = "ZAP"]?Set(DIAL=DAHDI${DIAL:3}))
exten => s,n,GotoIf($["${DB(DEVICE/${ARG1}/autoanswer/macro)}" != "" ]?macro)
exten => s,n,Set(phone=${SIPPEER(${CUT(DIAL,/,2)}:useragent)})
exten => s,n,ExecIf($["${phone:0:5}" = "Mitel"]?Set(CALLINFO=Call-Info: <sip:broadworks.net>\;answer-after=0))
exten => s,n,ExecIf($["${ALERTINFO}" != ""]?SipAddHeader(${ALERTINFO}))
exten => s,n,ExecIf($["${CALLINFO}" != ""]?SipAddHeader(${CALLINFO}))
exten => s,n,ExecIf($["${SIPURI}" != ""]?Set(__SIP_URI_OPTIONS=${SIPURI}))
exten => s,n+2(macro),Macro(${DB(DEVICE/${ARG1}/autoanswer/macro)},${ARG1})

; end of [macro-autoanswer]


[ext-paging]
include => ext-paging-custom
exten => _PAGE.,1,GotoIf($[ ${AMPUSER} = ${EXTEN:4} ]?skipself)
exten => _PAGE.,n(AVAIL),ChanIsAvail(${DB(DEVICE/${EXTEN:4}/dial)},s)
exten => _PAGE.,n,GotoIf($["${AVAILORIGCHAN}" == ""]?skipself)
exten => _PAGE.,n,GotoIf($["${DB(DND/${DB(DEVICE/${EXTEN:4}/user)})}" = "YES"]?skipself)
exten => _PAGE.,n(SKIPCHECK),Macro(autoanswer,${EXTEN:4})
exten => _PAGE.,n,Dial(${DIAL},${DTIME},${DOPTIONS})
exten => _PAGE.,n(skipself),Hangup
exten => _FPAGE.,1,GotoIf($[ ${AMPUSER} = ${EXTEN:5} ]?skipself)
exten => _FPAGE.,n(SKIPCHECK),Macro(autoanswer,${EXTEN:5})
exten => _FPAGE.,n,Dial(${DIAL},${DTIME},${DOPTIONS})
exten => _FPAGE.,n(skipself),Hangup
exten => 6666,1,Answer
exten => 6666,n,Macro(user-callerid,)
exten => 6666,n,Set(_AMPUSER=${AMPUSER})
exten => 6666,n,Set(_SIPURI=)
exten => 6666,n,Set(_ALERTINFO=Alert-Info: Ring Answer)
exten => 6666,n,Set(_CALLINFO=Call-Info: <uri>\;answer-after=0)
exten => 6666,n,Set(_SIPURI=intercom=true)
exten => 6666,n,Set(_DOPTIONS=A(beep))
exten => 6666,n,Set(_DTIME=5)
exten => 6666,n,Set(_ANSWERMACRO=)
exten => 6666,n,Set(__FORWARD_CONTEXT=block-cf)
exten => 6666,n,Page(LOCAL/PAGE601@ext-paging&LOCAL/PAGE602@ext-paging&LOCAL/PAGE603@ext-paging&LOCAL/PAGE605@ext-paging&LOCAL/PAGE606@ext-paging&LOCAL/PAGE608@ext-paging&LOCAL/PAGE614@ext-paging&LOCAL/PAGE615@ext-paging&LOCAL/PAGE616@ext-paging&LOCAL/PAGE617@ext-paging&LOCAL/PAGE618@ext-paging&LOCAL/PAGE619@ext-paging&LOCAL/PAGE620@ext-paging&LOCAL/PAGE621@ext-paging&LOCAL/PAGE622@ext-paging&LOCAL/PAGE651@ext-paging&LOCAL/PAGE653@ext-paging&LOCAL/PAGE654@ext-paging&LOCAL/PAGE655@ext-paging&LOCAL/PAGE656@ext-paging&LOCAL/PAGE658@ext-paging&LOCAL/PAGE659@ext-paging&LOCAL/PAGE660@ext-paging&LOCAL/PAGE678@ext-paging&LOCAL/PAGE685@ext-paging&LOCAL/PAGE686@ext-paging&LOCAL/PAGE687@ext-paging&LOCAL/PAGE688@ext-paging&LOCAL/PAGE701@ext-paging&LOCAL/PAGE777@ext-paging&LOCAL/PAGE808@ext-paging&LOCAL/PAGE810@ext-paging&LOCAL/PAGE815@ext-paging&LOCAL/PAGE816@ext-paging&LOCAL/PAGE818@ext-paging&LOCAL/PAGE819@ext-paging&LOCAL/PAGE852@ext-paging&LOCAL/PAGE853@ext-paging&LOCAL/PAGE855@ext-paging&LOCAL/PAGE856@ext-paging&LOCAL/PAGE857@ext-paging&LOCAL/PAGE858@ext-paging&LOCAL/PAGE859@ext-paging&LOCAL/PAGE861@ext-paging&LOCAL/PAGE862@ext-paging&LOCAL/PAGE863@ext-paging&LOCAL/PAGE886@ext-paging)

; end of [ext-paging]


[app-blacklist-check]
include => app-blacklist-check-custom
exten => s,1(check),GotoIf($["${BLACKLIST()}"="1"]?blacklisted)
exten => s,n,Set(CALLED_BLACKLIST=1)
exten => s,n,Return()
exten => s,n(blacklisted),Answer
exten => s,n,Wait(1)
exten => s,n,Zapateller()
exten => s,n,Playback(ss-noservice)
exten => s,n,Hangup

; end of [app-blacklist-check]


[app-blacklist]
include => app-blacklist-custom
exten => *30,1,Goto(app-blacklist-add,s,1)
exten => *32,1,Goto(app-blacklist-last,s,1)
exten => *31,1,Goto(app-blacklist-remove,s,1)

; end of [app-blacklist]


[app-blacklist-add]
include => app-blacklist-add-custom
exten => s,1,Answer
exten => s,n,Wait(1)
exten => s,n,Set(NumLoops=0)
exten => s,n(start),Playback(enter-num-blacklist)
exten => s,n,Set(TIMEOUT(digit)=5)
exten => s,n,Set(TIMEOUT(response)=60)
exten => s,n,Read(blacknr,then-press-pound,,,,)
exten => s,n,SayDigits(${blacknr})
exten => s,n,Playback(if-correct-press&digits/1)
exten => s,n,Noop(Waiting for input)
exten => s,n(end),WaitExten(60,)
exten => s,n,Playback(sorry-youre-having-problems&goodbye)
exten => 1,1,GotoIf($[ "${blacknr}" != ""]?:app-blacklist-add-invalid,s,1)
exten => 1,n,Set(DB(blacklist/${blacknr})=1)
exten => 1,n,Playback(num-was-successfully&added)
exten => 1,n,Wait(1)
exten => 1,n,Hangup

; end of [app-blacklist-add]


[app-blacklist-add-invalid]
include => app-blacklist-add-invalid-custom
exten => s,1,Set(NumLoops=$[${NumLoops} + 1])
exten => s,n,Playback(pm-invalid-option)
exten => s,n,GotoIf($[${NumLoops} < 3]?app-blacklist-add,s,start)
exten => s,n,Playback(goodbye)
exten => s,n,Hangup

; end of [app-blacklist-add-invalid]


[app-blacklist-last]
include => app-blacklist-last-custom
exten => s,1,Answer
exten => s,n,Wait(1)
exten => s,n,Set(lastcaller=${DB(CALLTRACE/${CALLERID(number)})})
exten => s,n,GotoIf($[ $[ "${lastcaller}" = "" ] | $[ "${lastcaller}" = "unknown" ] ]?noinfo)
exten => s,n,Playback(privacy-to-blacklist-last-caller&telephone-number)
exten => s,n,SayDigits(${lastcaller})
exten => s,n,Set(TIMEOUT(digit)=3)
exten => s,n,Set(TIMEOUT(response)=7)
exten => s,n,Playback(if-correct-press&digits/1)
exten => s,n,Goto(end)
exten => s,n(noinfo),Playback(unidentified-no-callback)
exten => s,n,Hangup
exten => s,n,Noop(Waiting for input)
exten => s,n(end),WaitExten(60,)
exten => s,n,Playback(sorry-youre-having-problems&goodbye)
exten => 1,1,Set(DB(blacklist/${lastcaller})=1)
exten => 1,n,Playback(num-was-successfully)
exten => 1,n,Playback(added)
exten => 1,n,Wait(1)
exten => 1,n,Hangup

; end of [app-blacklist-last]


[app-blacklist-remove]
include => app-blacklist-remove-custom
exten => s,1,Answer
exten => s,n,Wait(1)
exten => s,n,Playback(entr-num-rmv-blklist)
exten => s,n,Set(TIMEOUT(digit)=5)
exten => s,n,Set(TIMEOUT(response)=60)
exten => s,n,Read(blacknr,then-press-pound,,,,)
exten => s,n,SayDigits(${blacknr})
exten => s,n,Playback(if-correct-press&digits/1)
exten => s,n,Noop(Waiting for input)
exten => s,n(end),WaitExten(60,)
exten => s,n,Playback(sorry-youre-having-problems&goodbye)
exten => 1,1,Noop(Deleting: blacklist/${blacknr} ${DB_DELETE(blacklist/${blacknr})})
exten => 1,n,Playback(num-was-successfully&removed)
exten => 1,n,Wait(1)
exten => 1,n,Hangup

; end of [app-blacklist-remove]


[app-calltrace]
include => app-calltrace-custom
exten => *69,1,Goto(app-calltrace-perform,s,1)

; end of [app-calltrace]


[app-calltrace-perform]
include => app-calltrace-perform-custom
exten => s,1,Answer
exten => s,n,Wait(1)
exten => s,n,Macro(user-callerid,)
exten => s,n,Playback(info-about-last-call&telephone-number)
exten => s,n,Set(lastcaller=${DB(CALLTRACE/${AMPUSER})})
exten => s,n,GotoIf($[ $[ "${lastcaller}" = "" ] | $[ "${lastcaller}" = "unknown" ] ]?noinfo)
exten => s,n,SayDigits(${lastcaller})
exten => s,n,Set(TIMEOUT(digit)=3)
exten => s,n,Set(TIMEOUT(response)=7)
exten => s,n,Background(to-call-this-number&press-1)
exten => s,n,Goto(fin)
exten => s,n(noinfo),Playback(from-unknown-caller)
exten => s,n,Macro(hangupcall,)
exten => s,n(fin),Noop(Waiting for input)
exten => s,n,WaitExten(60,)
exten => s,n,Playback(sorry-youre-having-problems&goodbye)
exten => 1,1,Goto(from-internal,${lastcaller},1)
exten => i,1,Playback(vm-goodbye)
exten => i,n,Macro(hangupcall,)
exten => t,1,Playback(vm-goodbye)
exten => t,n,Macro(hangupcall,)

; end of [app-calltrace-perform]


[app-directory]
include => app-directory-custom
exten => #,1,Answer
exten => #,n,Wait(1)
exten => #,n,AGI(directory,${DIR-CONTEXT},from-did-direct,${DIRECTORY:0:1}${DIRECTORY_OPTS})
exten => #,n,Playback(vm-goodbye)
exten => #,n,Hangup
exten => o,1,Playback(privacy-incorrect)

; end of [app-directory]


[app-echo-test]
include => app-echo-test-custom
exten => *43,1,Answer
exten => *43,n,Wait(1)
exten => *43,n,Playback(demo-echotest)
exten => *43,n,Echo()
exten => *43,n,Playback(demo-echodone)
exten => *43,n,Hangup

; end of [app-echo-test]


[app-speakextennum]
include => app-speakextennum-custom
exten => *65,1,Answer
exten => *65,n,Wait(1)
exten => *65,n,Macro(user-callerid,)
exten => *65,n,Playback(your)
exten => *65,n,Playback(extension)
exten => *65,n,Playback(number)
exten => *65,n,Playback(is)
exten => *65,n,SayDigits(${AMPUSER})
exten => *65,n,Wait(2)
exten => *65,n,Hangup

; end of [app-speakextennum]


[app-speakingclock]
include => app-speakingclock-custom
exten => *60,1,Answer
exten => *60,n,Wait(1)
exten => *60,n,Set(NumLoops=0)
exten => *60,n(start),Set(FutureTime=$[${EPOCH} + 11])
exten => *60,n,Playback(at-tone-time-exactly)
exten => *60,n,GotoIf($["${TIMEFORMAT}" = "kM"]?hr24format)
exten => *60,n,SayUnixTime(${FutureTime},,IM 'and' S 'seconds' p)
exten => *60,n,Goto(waitloop)
exten => *60,n(hr24format),SayUnixTime(${FutureTime},,kM 'and' S 'seconds')
exten => *60,n(waitloop),Set(TimeLeft=$[${FutureTime} - ${EPOCH}])
exten => *60,n,GotoIf($[${TimeLeft} < 1]?playbeep)
exten => *60,n,Wait(1)
exten => *60,n,Goto(waitloop)
exten => *60,n(playbeep),Playback(beep)
exten => *60,n,Wait(5)
exten => *60,n,Set(NumLoops=$[${NumLoops} + 1])
exten => *60,n,GotoIf($[${NumLoops} < 5]?start)
exten => *60,n,Playback(goodbye)
exten => *60,n,Hangup

; end of [app-speakingclock]


[app-userlogonoff]
include => app-userlogonoff-custom
exten => *12,1,Macro(user-logoff,)
exten => *12,n(hook_off),Hangup
exten => *11,1,Macro(user-logon,)
exten => *11,n(hook_on_1),Hangup
exten => _*11.,1,Macro(user-logon,${EXTEN:3},)
exten => _*11.,n(hook_on_2),Hangup

; end of [app-userlogonoff]


[app-pickup]
include => app-pickup-custom
exten => _**.,1,Pickup(${EXTEN:2}&${EXTEN:2}@ext-local&${EXTEN:2}@from-internal&${EXTEN:2}@from-internal-xfer&${EXTEN:2}@from-did-direct&LC-${EXTEN:2}@from-internal&LC-${EXTEN:2}@from-internal-xfer&FMPR-${EXTEN:2}@from-internal&FMPR-${EXTEN:2}@from-internal-xfer&FMPR-${EXTEN:2}@from-did-direct)
exten => _**.,n,Hangup
exten => **603,1,Pickup(603&603@ext-local&603@from-internal&603@from-internal-xfer&603@from-did-direct&LC-603@from-internal&LC-603@from-internal-xfer&FMPR-603@from-internal&FMPR-603@from-internal-xfer&FMPR-603@from-did-direct&100@from-internal&100@from-internal-xfer&100@ext-group)
exten => **603,n,Hangup
exten => **621,1,Pickup(621&621@ext-local&621@from-internal&621@from-internal-xfer&621@from-did-direct&LC-621@from-internal&LC-621@from-internal-xfer&FMPR-621@from-internal&FMPR-621@from-internal-xfer&FMPR-621@from-did-direct&100@from-internal&100@from-internal-xfer&100@ext-group&104@from-internal&104@from-internal-xfer&104@ext-group&105@from-internal&105@from-internal-xfer&105@ext-group)
exten => **621,n,Hangup
exten => **605,1,Pickup(605&605@ext-local&605@from-internal&605@from-internal-xfer&605@from-did-direct&LC-605@from-internal&LC-605@from-internal-xfer&FMPR-605@from-internal&FMPR-605@from-internal-xfer&FMPR-605@from-did-direct&101@from-internal&101@from-internal-xfer&101@ext-group)
exten => **605,n,Hangup
exten => **819,1,Pickup(819&819@ext-local&819@from-internal&819@from-internal-xfer&819@from-did-direct&LC-819@from-internal&LC-819@from-internal-xfer&FMPR-819@from-internal&FMPR-819@from-internal-xfer&FMPR-819@from-did-direct&101@from-internal&101@from-internal-xfer&101@ext-group)
exten => **819,n,Hangup
exten => **651,1,Pickup(651&651@ext-local&651@from-internal&651@from-internal-xfer&651@from-did-direct&LC-651@from-internal&LC-651@from-internal-xfer&FMPR-651@from-internal&FMPR-651@from-internal-xfer&FMPR-651@from-did-direct&102@from-internal&102@from-internal-xfer&102@ext-group&103@from-internal&103@from-internal-xfer&103@ext-group)
exten => **651,n,Hangup
exten => **653,1,Pickup(653&653@ext-local&653@from-internal&653@from-internal-xfer&653@from-did-direct&LC-653@from-internal&LC-653@from-internal-xfer&FMPR-653@from-internal&FMPR-653@from-internal-xfer&FMPR-653@from-did-direct&102@from-internal&102@from-internal-xfer&102@ext-group&103@from-internal&103@from-internal-xfer&103@ext-group)
exten => **653,n,Hangup
exten => **654,1,Pickup(654&654@ext-local&654@from-internal&654@from-internal-xfer&654@from-did-direct&LC-654@from-internal&LC-654@from-internal-xfer&FMPR-654@from-internal&FMPR-654@from-internal-xfer&FMPR-654@from-did-direct&102@from-internal&102@from-internal-xfer&102@ext-group&103@from-internal&103@from-internal-xfer&103@ext-group)
exten => **654,n,Hangup
exten => **655,1,Pickup(655&655@ext-local&655@from-internal&655@from-internal-xfer&655@from-did-direct&LC-655@from-internal&LC-655@from-internal-xfer&FMPR-655@from-internal&FMPR-655@from-internal-xfer&FMPR-655@from-did-direct&102@from-internal&102@from-internal-xfer&102@ext-group&103@from-internal&103@from-internal-xfer&103@ext-group)
exten => **655,n,Hangup
exten => **656,1,Pickup(656&656@ext-local&656@from-internal&656@from-internal-xfer&656@from-did-direct&LC-656@from-internal&LC-656@from-internal-xfer&FMPR-656@from-internal&FMPR-656@from-internal-xfer&FMPR-656@from-did-direct&102@from-internal&102@from-internal-xfer&102@ext-group&103@from-internal&103@from-internal-xfer&103@ext-group)
exten => **656,n,Hangup
exten => **652,1,Pickup(652&652@ext-local&652@from-internal&652@from-internal-xfer&652@from-did-direct&LC-652@from-internal&LC-652@from-internal-xfer&FMPR-652@from-internal&FMPR-652@from-internal-xfer&FMPR-652@from-did-direct&102@from-internal&102@from-internal-xfer&102@ext-group&103@from-internal&103@from-internal-xfer&103@ext-group)
exten => **652,n,Hangup
exten => **601,1,Pickup(601&601@ext-local&601@from-internal&601@from-internal-xfer&601@from-did-direct&LC-601@from-internal&LC-601@from-internal-xfer&FMPR-601@from-internal&FMPR-601@from-internal-xfer&FMPR-601@from-did-direct&104@from-internal&104@from-internal-xfer&104@ext-group&105@from-internal&105@from-internal-xfer&105@ext-group)
exten => **601,n,Hangup
exten => **602,1,Pickup(602&602@ext-local&602@from-internal&602@from-internal-xfer&602@from-did-direct&LC-602@from-internal&LC-602@from-internal-xfer&FMPR-602@from-internal&FMPR-602@from-internal-xfer&FMPR-602@from-did-direct&104@from-internal&104@from-internal-xfer&104@ext-group&105@from-internal&105@from-internal-xfer&105@ext-group)
exten => **602,n,Hangup
exten => **618,1,Pickup(618&618@ext-local&618@from-internal&618@from-internal-xfer&618@from-did-direct&LC-618@from-internal&LC-618@from-internal-xfer&FMPR-618@from-internal&FMPR-618@from-internal-xfer&FMPR-618@from-did-direct&104@from-internal&104@from-internal-xfer&104@ext-group&105@from-internal&105@from-internal-xfer&105@ext-group)
exten => **618,n,Hangup
exten => **619,1,Pickup(619&619@ext-local&619@from-internal&619@from-internal-xfer&619@from-did-direct&LC-619@from-internal&LC-619@from-internal-xfer&FMPR-619@from-internal&FMPR-619@from-internal-xfer&FMPR-619@from-did-direct&104@from-internal&104@from-internal-xfer&104@ext-group&105@from-internal&105@from-internal-xfer&105@ext-group)
exten => **619,n,Hangup
exten => **616,1,Pickup(616&616@ext-local&616@from-internal&616@from-internal-xfer&616@from-did-direct&LC-616@from-internal&LC-616@from-internal-xfer&FMPR-616@from-internal&FMPR-616@from-internal-xfer&FMPR-616@from-did-direct&104@from-internal&104@from-internal-xfer&104@ext-group&105@from-internal&105@from-internal-xfer&105@ext-group)
exten => **616,n,Hangup
exten => **620,1,Pickup(620&620@ext-local&620@from-internal&620@from-internal-xfer&620@from-did-direct&LC-620@from-internal&LC-620@from-internal-xfer&FMPR-620@from-internal&FMPR-620@from-internal-xfer&FMPR-620@from-did-direct&104@from-internal&104@from-internal-xfer&104@ext-group&105@from-internal&105@from-internal-xfer&105@ext-group)
exten => **620,n,Hangup
exten => **606,1,Pickup(606&606@ext-local&606@from-internal&606@from-internal-xfer&606@from-did-direct&LC-606@from-internal&LC-606@from-internal-xfer&FMPR-606@from-internal&FMPR-606@from-internal-xfer&FMPR-606@from-did-direct&104@from-internal&104@from-internal-xfer&104@ext-group&105@from-internal&105@from-internal-xfer&105@ext-group)
exten => **606,n,Hangup

; end of [app-pickup]


[app-zapbarge]
include => app-zapbarge-custom
exten => 888,1,Macro(user-callerid,)
exten => 888,n,Set(GROUP()=${CALLERID(number)})
exten => 888,n,Answer
exten => 888,n,Wait(1)
exten => 888,n,DAHDIBarge()
exten => 888,n,Hangup

; end of [app-zapbarge]


[app-chanspy]
include => app-chanspy-custom
exten => 555,1,Macro(user-callerid,)
exten => 555,n,Answer
exten => 555,n,Wait(1)
exten => 555,n,ChanSpy()
exten => 555,n,Hangup

; end of [app-chanspy]


[ext-test]
include => ext-test-custom
exten => 7777,1,Goto(from-pstn,${EXTEN},1)
exten => h,1,Macro(hangupcall,)

; end of [ext-test]


[ext-did]
include => ext-did-custom
include => ext-did-0001
include => ext-did-0002
exten => foo,1,Noop(bar)

; end of [ext-did]


[ext-did-catchall]
include => ext-did-catchall-custom
exten => _.,1,Noop(Catch-All DID Match - Found ${EXTEN} - You probably want a DID for this.)
exten => _.,n,Goto(ext-did,s,1)

; end of [ext-did-catchall]


[ext-local]
include => ext-local-custom
exten => 301,1,Macro(exten-vm,novm,301)
exten => 301,n,Goto(${IVR_CONTEXT},return,1)
exten => 301,hint,SIP/301
exten => 302,1,Macro(exten-vm,302,302)
exten => 302,n,Goto(vmret,1)
exten => 302,hint,SIP/302
exten => ${VM_PREFIX}302,1,Macro(vm,302,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}302,n,Goto(vmret,1)
exten => vmb302,1,Macro(vm,302,BUSY,${IVR_RETVM})
exten => vmb302,n,Goto(vmret,1)
exten => vmu302,1,Macro(vm,302,NOANSWER,${IVR_RETVM})
exten => vmu302,n,Goto(vmret,1)
exten => vms302,1,Macro(vm,302,NOMESSAGE,${IVR_RETVM})
exten => vms302,n,Goto(vmret,1)
exten => 303,1,Macro(exten-vm,novm,303)
exten => 303,n,Goto(${IVR_CONTEXT},return,1)
exten => 303,hint,SIP/303
exten => 304,1,Macro(exten-vm,novm,304)
exten => 304,n,Goto(${IVR_CONTEXT},return,1)
exten => 304,hint,SIP/304
exten => 601,1,Macro(exten-vm,novm,601)
exten => 601,n,Goto(${IVR_CONTEXT},return,1)
exten => 601,hint,SIP/601
exten => 602,1,Macro(exten-vm,602,602)
exten => 602,n,Goto(vmret,1)
exten => 602,hint,SIP/602
exten => ${VM_PREFIX}602,1,Macro(vm,602,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}602,n,Goto(vmret,1)
exten => vmb602,1,Macro(vm,602,BUSY,${IVR_RETVM})
exten => vmb602,n,Goto(vmret,1)
exten => vmu602,1,Macro(vm,602,NOANSWER,${IVR_RETVM})
exten => vmu602,n,Goto(vmret,1)
exten => vms602,1,Macro(vm,602,NOMESSAGE,${IVR_RETVM})
exten => vms602,n,Goto(vmret,1)
exten => 603,1,Macro(exten-vm,603,603)
exten => 603,n,Goto(vmret,1)
exten => 603,hint,SIP/603
exten => ${VM_PREFIX}603,1,Macro(vm,603,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}603,n,Goto(vmret,1)
exten => vmb603,1,Macro(vm,603,BUSY,${IVR_RETVM})
exten => vmb603,n,Goto(vmret,1)
exten => vmu603,1,Macro(vm,603,NOANSWER,${IVR_RETVM})
exten => vmu603,n,Goto(vmret,1)
exten => vms603,1,Macro(vm,603,NOMESSAGE,${IVR_RETVM})
exten => vms603,n,Goto(vmret,1)
exten => 605,1,Macro(exten-vm,novm,605)
exten => 605,n,Goto(${IVR_CONTEXT},return,1)
exten => 605,hint,SIP/605
exten => 606,1,Macro(exten-vm,606,606)
exten => 606,n,Goto(vmret,1)
exten => 606,hint,SIP/606
exten => ${VM_PREFIX}606,1,Macro(vm,606,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}606,n,Goto(vmret,1)
exten => vmb606,1,Macro(vm,606,BUSY,${IVR_RETVM})
exten => vmb606,n,Goto(vmret,1)
exten => vmu606,1,Macro(vm,606,NOANSWER,${IVR_RETVM})
exten => vmu606,n,Goto(vmret,1)
exten => vms606,1,Macro(vm,606,NOMESSAGE,${IVR_RETVM})
exten => vms606,n,Goto(vmret,1)
exten => 608,1,Macro(exten-vm,novm,608)
exten => 608,n,Goto(${IVR_CONTEXT},return,1)
exten => 608,hint,SIP/608
exten => 609,1,Macro(exten-vm,609,609)
exten => 609,n,Goto(vmret,1)
exten => 609,hint,SIP/609
exten => ${VM_PREFIX}609,1,Macro(vm,609,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}609,n,Goto(vmret,1)
exten => vmb609,1,Macro(vm,609,BUSY,${IVR_RETVM})
exten => vmb609,n,Goto(vmret,1)
exten => vmu609,1,Macro(vm,609,NOANSWER,${IVR_RETVM})
exten => vmu609,n,Goto(vmret,1)
exten => vms609,1,Macro(vm,609,NOMESSAGE,${IVR_RETVM})
exten => vms609,n,Goto(vmret,1)
exten => 614,1,Macro(exten-vm,novm,614)
exten => 614,n,Goto(${IVR_CONTEXT},return,1)
exten => 614,hint,SIP/614
exten => 615,1,Macro(exten-vm,615,615)
exten => 615,n,Goto(vmret,1)
exten => 615,hint,SIP/615
exten => ${VM_PREFIX}615,1,Macro(vm,615,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}615,n,Goto(vmret,1)
exten => vmb615,1,Macro(vm,615,BUSY,${IVR_RETVM})
exten => vmb615,n,Goto(vmret,1)
exten => vmu615,1,Macro(vm,615,NOANSWER,${IVR_RETVM})
exten => vmu615,n,Goto(vmret,1)
exten => vms615,1,Macro(vm,615,NOMESSAGE,${IVR_RETVM})
exten => vms615,n,Goto(vmret,1)
exten => 616,1,Macro(exten-vm,616,616)
exten => 616,n,Goto(vmret,1)
exten => 616,hint,SIP/616
exten => ${VM_PREFIX}616,1,Macro(vm,616,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}616,n,Goto(vmret,1)
exten => vmb616,1,Macro(vm,616,BUSY,${IVR_RETVM})
exten => vmb616,n,Goto(vmret,1)
exten => vmu616,1,Macro(vm,616,NOANSWER,${IVR_RETVM})
exten => vmu616,n,Goto(vmret,1)
exten => vms616,1,Macro(vm,616,NOMESSAGE,${IVR_RETVM})
exten => vms616,n,Goto(vmret,1)
exten => 617,1,Macro(exten-vm,617,617)
exten => 617,n,Goto(vmret,1)
exten => 617,hint,SIP/617
exten => ${VM_PREFIX}617,1,Macro(vm,617,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}617,n,Goto(vmret,1)
exten => vmb617,1,Macro(vm,617,BUSY,${IVR_RETVM})
exten => vmb617,n,Goto(vmret,1)
exten => vmu617,1,Macro(vm,617,NOANSWER,${IVR_RETVM})
exten => vmu617,n,Goto(vmret,1)
exten => vms617,1,Macro(vm,617,NOMESSAGE,${IVR_RETVM})
exten => vms617,n,Goto(vmret,1)
exten => 618,1,Macro(exten-vm,618,618)
exten => 618,n,Goto(vmret,1)
exten => 618,hint,SIP/618
exten => ${VM_PREFIX}618,1,Macro(vm,618,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}618,n,Goto(vmret,1)
exten => vmb618,1,Macro(vm,618,BUSY,${IVR_RETVM})
exten => vmb618,n,Goto(vmret,1)
exten => vmu618,1,Macro(vm,618,NOANSWER,${IVR_RETVM})
exten => vmu618,n,Goto(vmret,1)
exten => vms618,1,Macro(vm,618,NOMESSAGE,${IVR_RETVM})
exten => vms618,n,Goto(vmret,1)
exten => 619,1,Macro(exten-vm,novm,619)
exten => 619,n,Goto(${IVR_CONTEXT},return,1)
exten => 619,hint,SIP/619
exten => 620,1,Macro(exten-vm,novm,620)
exten => 620,n,Goto(${IVR_CONTEXT},return,1)
exten => 620,hint,SIP/620
exten => 621,1,Macro(exten-vm,621,621)
exten => 621,n,Goto(vmret,1)
exten => 621,hint,SIP/621
exten => ${VM_PREFIX}621,1,Macro(vm,621,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}621,n,Goto(vmret,1)
exten => vmb621,1,Macro(vm,621,BUSY,${IVR_RETVM})
exten => vmb621,n,Goto(vmret,1)
exten => vmu621,1,Macro(vm,621,NOANSWER,${IVR_RETVM})
exten => vmu621,n,Goto(vmret,1)
exten => vms621,1,Macro(vm,621,NOMESSAGE,${IVR_RETVM})
exten => vms621,n,Goto(vmret,1)
exten => 622,1,Macro(exten-vm,622,622)
exten => 622,n,Goto(vmret,1)
exten => 622,hint,SIP/622
exten => ${VM_PREFIX}622,1,Macro(vm,622,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}622,n,Goto(vmret,1)
exten => vmb622,1,Macro(vm,622,BUSY,${IVR_RETVM})
exten => vmb622,n,Goto(vmret,1)
exten => vmu622,1,Macro(vm,622,NOANSWER,${IVR_RETVM})
exten => vmu622,n,Goto(vmret,1)
exten => vms622,1,Macro(vm,622,NOMESSAGE,${IVR_RETVM})
exten => vms622,n,Goto(vmret,1)
exten => 650,1,Macro(exten-vm,650,650)
exten => 650,n,Goto(vmret,1)
exten => 650,hint,SIP/650
exten => ${VM_PREFIX}650,1,Macro(vm,650,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}650,n,Goto(vmret,1)
exten => vmb650,1,Macro(vm,650,BUSY,${IVR_RETVM})
exten => vmb650,n,Goto(vmret,1)
exten => vmu650,1,Macro(vm,650,NOANSWER,${IVR_RETVM})
exten => vmu650,n,Goto(vmret,1)
exten => vms650,1,Macro(vm,650,NOMESSAGE,${IVR_RETVM})
exten => vms650,n,Goto(vmret,1)
exten => 651,1,Macro(exten-vm,novm,651)
exten => 651,n,Goto(${IVR_CONTEXT},return,1)
exten => 651,hint,SIP/651
exten => 652,1,Macro(exten-vm,novm,652)
exten => 652,n,Goto(${IVR_CONTEXT},return,1)
exten => 652,hint,IAX2/652
exten => 653,1,Macro(exten-vm,novm,653)
exten => 653,n,Goto(${IVR_CONTEXT},return,1)
exten => 653,hint,SIP/653
exten => 654,1,Macro(exten-vm,novm,654)
exten => 654,n,Goto(${IVR_CONTEXT},return,1)
exten => 654,hint,SIP/654
exten => 655,1,Macro(exten-vm,novm,655)
exten => 655,n,Goto(${IVR_CONTEXT},return,1)
exten => 655,hint,SIP/655
exten => 656,1,Macro(exten-vm,novm,656)
exten => 656,n,Goto(${IVR_CONTEXT},return,1)
exten => 656,hint,SIP/656
exten => 657,1,Macro(exten-vm,novm,657)
exten => 657,n,Goto(${IVR_CONTEXT},return,1)
exten => 657,hint,SIP/657
exten => 658,1,Macro(exten-vm,novm,658)
exten => 658,n,Goto(${IVR_CONTEXT},return,1)
exten => 658,hint,SIP/658
exten => 659,1,Macro(exten-vm,659,659)
exten => 659,n,Goto(vmret,1)
exten => 659,hint,SIP/659
exten => ${VM_PREFIX}659,1,Macro(vm,659,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}659,n,Goto(vmret,1)
exten => vmb659,1,Macro(vm,659,BUSY,${IVR_RETVM})
exten => vmb659,n,Goto(vmret,1)
exten => vmu659,1,Macro(vm,659,NOANSWER,${IVR_RETVM})
exten => vmu659,n,Goto(vmret,1)
exten => vms659,1,Macro(vm,659,NOMESSAGE,${IVR_RETVM})
exten => vms659,n,Goto(vmret,1)
exten => 660,1,Macro(exten-vm,novm,660)
exten => 660,n,Goto(${IVR_CONTEXT},return,1)
exten => 660,hint,IAX2/660
exten => 678,1,Macro(exten-vm,novm,678)
exten => 678,n,Goto(${IVR_CONTEXT},return,1)
exten => 678,hint,SIP/678
exten => 685,1,Macro(exten-vm,novm,685)
exten => 685,n,Goto(${IVR_CONTEXT},return,1)
exten => 685,hint,SIP/685
exten => 686,1,Macro(exten-vm,novm,686)
exten => 686,n,Goto(${IVR_CONTEXT},return,1)
exten => 686,hint,SIP/686
exten => 687,1,Macro(exten-vm,novm,687)
exten => 687,n,Goto(${IVR_CONTEXT},return,1)
exten => 687,hint,SIP/687
exten => 688,1,Macro(exten-vm,novm,688)
exten => 688,n,Goto(${IVR_CONTEXT},return,1)
exten => 688,hint,SIP/688
exten => 701,1,Macro(exten-vm,novm,701)
exten => 701,n,Goto(${IVR_CONTEXT},return,1)
exten => 701,hint,SIP/701
exten => 777,1,Macro(exten-vm,novm,777)
exten => 777,n,Goto(${IVR_CONTEXT},return,1)
exten => 777,hint,SIP/777
exten => 808,1,Macro(exten-vm,novm,808)
exten => 808,n,Goto(${IVR_CONTEXT},return,1)
exten => 808,hint,SIP/808
exten => 810,1,Macro(exten-vm,novm,810)
exten => 810,n,Goto(${IVR_CONTEXT},return,1)
exten => 810,hint,SIP/810
exten => 815,1,Macro(exten-vm,novm,815)
exten => 815,n,Goto(${IVR_CONTEXT},return,1)
exten => 815,hint,SIP/815
exten => 816,1,Macro(exten-vm,novm,816)
exten => 816,n,Goto(${IVR_CONTEXT},return,1)
exten => 816,hint,SIP/816
exten => 818,1,Macro(exten-vm,novm,818)
exten => 818,n,Goto(${IVR_CONTEXT},return,1)
exten => 818,hint,SIP/818
exten => 819,1,Macro(exten-vm,novm,819)
exten => 819,n,Goto(${IVR_CONTEXT},return,1)
exten => 819,hint,SIP/819
exten => 820,1,Macro(exten-vm,820,820)
exten => 820,n,Goto(vmret,1)
exten => 820,hint,SIP/820
exten => ${VM_PREFIX}820,1,Macro(vm,820,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}820,n,Goto(vmret,1)
exten => vmb820,1,Macro(vm,820,BUSY,${IVR_RETVM})
exten => vmb820,n,Goto(vmret,1)
exten => vmu820,1,Macro(vm,820,NOANSWER,${IVR_RETVM})
exten => vmu820,n,Goto(vmret,1)
exten => vms820,1,Macro(vm,820,NOMESSAGE,${IVR_RETVM})
exten => vms820,n,Goto(vmret,1)
exten => 852,1,Macro(exten-vm,novm,852)
exten => 852,n,Goto(${IVR_CONTEXT},return,1)
exten => 852,hint,SIP/852
exten => 853,1,Macro(exten-vm,novm,853)
exten => 853,n,Goto(${IVR_CONTEXT},return,1)
exten => 853,hint,SIP/853
exten => 855,1,Macro(exten-vm,novm,855)
exten => 855,n,Goto(${IVR_CONTEXT},return,1)
exten => 855,hint,SIP/855
exten => 856,1,Macro(exten-vm,novm,856)
exten => 856,n,Goto(${IVR_CONTEXT},return,1)
exten => 856,hint,SIP/856
exten => 857,1,Macro(exten-vm,novm,857)
exten => 857,n,Goto(${IVR_CONTEXT},return,1)
exten => 857,hint,SIP/857
exten => 858,1,Macro(exten-vm,novm,858)
exten => 858,n,Goto(${IVR_CONTEXT},return,1)
exten => 858,hint,SIP/858
exten => 859,1,Macro(exten-vm,novm,859)
exten => 859,n,Goto(${IVR_CONTEXT},return,1)
exten => 859,hint,SIP/859
exten => 861,1,Macro(exten-vm,novm,861)
exten => 861,n,Goto(${IVR_CONTEXT},return,1)
exten => 861,hint,SIP/861
exten => 862,1,Macro(exten-vm,novm,862)
exten => 862,n,Goto(${IVR_CONTEXT},return,1)
exten => 862,hint,SIP/862
exten => 863,1,Macro(exten-vm,novm,863)
exten => 863,n,Goto(${IVR_CONTEXT},return,1)
exten => 863,hint,SIP/863
exten => 886,1,Macro(exten-vm,novm,886)
exten => 886,n,Goto(${IVR_CONTEXT},return,1)
exten => 886,hint,SIP/886
exten => 919,1,Macro(exten-vm,novm,919)
exten => 919,n,Goto(${IVR_CONTEXT},return,1)
exten => 919,hint,SIP/919
exten => 978,1,Macro(exten-vm,novm,978)
exten => 978,n,Goto(${IVR_CONTEXT},return,1)
exten => 978,hint,SIP/978
exten => 999,1,Macro(exten-vm,999,999)
exten => 999,n,Goto(vmret,1)
exten => 999,hint,SIP/999
exten => ${VM_PREFIX}999,1,Macro(vm,999,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}999,n,Goto(vmret,1)
exten => vmb999,1,Macro(vm,999,BUSY,${IVR_RETVM})
exten => vmb999,n,Goto(vmret,1)
exten => vmu999,1,Macro(vm,999,NOANSWER,${IVR_RETVM})
exten => vmu999,n,Goto(vmret,1)
exten => vms999,1,Macro(vm,999,NOMESSAGE,${IVR_RETVM})
exten => vms999,n,Goto(vmret,1)
exten => 8888,1,Macro(exten-vm,novm,8888)
exten => 8888,n,Goto(${IVR_CONTEXT},return,1)
exten => 8888,hint,SIP/8888
exten => vmret,1,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?playret)
exten => vmret,n,Hangup
exten => vmret,n(playret),Playback(exited-vm-will-be-transfered&silence/1)
exten => vmret,n,Goto(${IVR_CONTEXT},return,1)
exten => h,1,Macro(hangupcall,)

; end of [ext-local]


[from-did-direct-ivr]
include => from-did-direct-ivr-custom
exten => 301,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 301,n,Set(__NODEST=)
exten => 301,n,Goto(from-did-direct,301,1)
exten => 302,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 302,n,Set(__NODEST=)
exten => 302,n,Goto(from-did-direct,302,1)
exten => ${VM_PREFIX}302,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}302,n,Set(__NODEST=)
exten => ${VM_PREFIX}302,n,Macro(vm,302,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}302,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 303,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 303,n,Set(__NODEST=)
exten => 303,n,Goto(from-did-direct,303,1)
exten => 304,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 304,n,Set(__NODEST=)
exten => 304,n,Goto(from-did-direct,304,1)
exten => 601,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 601,n,Set(__NODEST=)
exten => 601,n,Goto(from-did-direct,601,1)
exten => 602,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 602,n,Set(__NODEST=)
exten => 602,n,Goto(from-did-direct,602,1)
exten => ${VM_PREFIX}602,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}602,n,Set(__NODEST=)
exten => ${VM_PREFIX}602,n,Macro(vm,602,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}602,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 603,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 603,n,Set(__NODEST=)
exten => 603,n,Goto(from-did-direct,603,1)
exten => ${VM_PREFIX}603,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}603,n,Set(__NODEST=)
exten => ${VM_PREFIX}603,n,Macro(vm,603,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}603,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 605,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 605,n,Set(__NODEST=)
exten => 605,n,Goto(from-did-direct,605,1)
exten => 606,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 606,n,Set(__NODEST=)
exten => 606,n,Goto(from-did-direct,606,1)
exten => ${VM_PREFIX}606,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}606,n,Set(__NODEST=)
exten => ${VM_PREFIX}606,n,Macro(vm,606,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}606,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 608,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 608,n,Set(__NODEST=)
exten => 608,n,Goto(from-did-direct,608,1)
exten => 609,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 609,n,Set(__NODEST=)
exten => 609,n,Goto(from-did-direct,609,1)
exten => ${VM_PREFIX}609,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}609,n,Set(__NODEST=)
exten => ${VM_PREFIX}609,n,Macro(vm,609,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}609,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 614,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 614,n,Set(__NODEST=)
exten => 614,n,Goto(from-did-direct,614,1)
exten => 615,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 615,n,Set(__NODEST=)
exten => 615,n,Goto(from-did-direct,615,1)
exten => ${VM_PREFIX}615,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}615,n,Set(__NODEST=)
exten => ${VM_PREFIX}615,n,Macro(vm,615,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}615,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 616,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 616,n,Set(__NODEST=)
exten => 616,n,Goto(from-did-direct,616,1)
exten => ${VM_PREFIX}616,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}616,n,Set(__NODEST=)
exten => ${VM_PREFIX}616,n,Macro(vm,616,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}616,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 617,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 617,n,Set(__NODEST=)
exten => 617,n,Goto(from-did-direct,617,1)
exten => ${VM_PREFIX}617,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}617,n,Set(__NODEST=)
exten => ${VM_PREFIX}617,n,Macro(vm,617,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}617,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 618,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 618,n,Set(__NODEST=)
exten => 618,n,Goto(from-did-direct,618,1)
exten => ${VM_PREFIX}618,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}618,n,Set(__NODEST=)
exten => ${VM_PREFIX}618,n,Macro(vm,618,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}618,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 619,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 619,n,Set(__NODEST=)
exten => 619,n,Goto(from-did-direct,619,1)
exten => 620,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 620,n,Set(__NODEST=)
exten => 620,n,Goto(from-did-direct,620,1)
exten => 621,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 621,n,Set(__NODEST=)
exten => 621,n,Goto(from-did-direct,621,1)
exten => ${VM_PREFIX}621,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}621,n,Set(__NODEST=)
exten => ${VM_PREFIX}621,n,Macro(vm,621,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}621,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 622,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 622,n,Set(__NODEST=)
exten => 622,n,Goto(from-did-direct,622,1)
exten => ${VM_PREFIX}622,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}622,n,Set(__NODEST=)
exten => ${VM_PREFIX}622,n,Macro(vm,622,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}622,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 650,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 650,n,Set(__NODEST=)
exten => 650,n,Goto(from-did-direct,650,1)
exten => ${VM_PREFIX}650,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}650,n,Set(__NODEST=)
exten => ${VM_PREFIX}650,n,Macro(vm,650,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}650,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 651,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 651,n,Set(__NODEST=)
exten => 651,n,Goto(from-did-direct,651,1)
exten => 652,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 652,n,Set(__NODEST=)
exten => 652,n,Goto(from-did-direct,652,1)
exten => 653,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 653,n,Set(__NODEST=)
exten => 653,n,Goto(from-did-direct,653,1)
exten => 654,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 654,n,Set(__NODEST=)
exten => 654,n,Goto(from-did-direct,654,1)
exten => 655,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 655,n,Set(__NODEST=)
exten => 655,n,Goto(from-did-direct,655,1)
exten => 656,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 656,n,Set(__NODEST=)
exten => 656,n,Goto(from-did-direct,656,1)
exten => 657,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 657,n,Set(__NODEST=)
exten => 657,n,Goto(from-did-direct,657,1)
exten => 658,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 658,n,Set(__NODEST=)
exten => 658,n,Goto(from-did-direct,658,1)
exten => 659,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 659,n,Set(__NODEST=)
exten => 659,n,Goto(from-did-direct,659,1)
exten => ${VM_PREFIX}659,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}659,n,Set(__NODEST=)
exten => ${VM_PREFIX}659,n,Macro(vm,659,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}659,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 660,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 660,n,Set(__NODEST=)
exten => 660,n,Goto(from-did-direct,660,1)
exten => 678,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 678,n,Set(__NODEST=)
exten => 678,n,Goto(from-did-direct,678,1)
exten => 685,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 685,n,Set(__NODEST=)
exten => 685,n,Goto(from-did-direct,685,1)
exten => 686,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 686,n,Set(__NODEST=)
exten => 686,n,Goto(from-did-direct,686,1)
exten => 687,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 687,n,Set(__NODEST=)
exten => 687,n,Goto(from-did-direct,687,1)
exten => 688,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 688,n,Set(__NODEST=)
exten => 688,n,Goto(from-did-direct,688,1)
exten => 701,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 701,n,Set(__NODEST=)
exten => 701,n,Goto(from-did-direct,701,1)
exten => 777,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 777,n,Set(__NODEST=)
exten => 777,n,Goto(from-did-direct,777,1)
exten => 808,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 808,n,Set(__NODEST=)
exten => 808,n,Goto(from-did-direct,808,1)
exten => 810,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 810,n,Set(__NODEST=)
exten => 810,n,Goto(from-did-direct,810,1)
exten => 815,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 815,n,Set(__NODEST=)
exten => 815,n,Goto(from-did-direct,815,1)
exten => 816,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 816,n,Set(__NODEST=)
exten => 816,n,Goto(from-did-direct,816,1)
exten => 818,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 818,n,Set(__NODEST=)
exten => 818,n,Goto(from-did-direct,818,1)
exten => 819,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 819,n,Set(__NODEST=)
exten => 819,n,Goto(from-did-direct,819,1)
exten => 820,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 820,n,Set(__NODEST=)
exten => 820,n,Goto(from-did-direct,820,1)
exten => ${VM_PREFIX}820,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}820,n,Set(__NODEST=)
exten => ${VM_PREFIX}820,n,Macro(vm,820,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}820,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 852,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 852,n,Set(__NODEST=)
exten => 852,n,Goto(from-did-direct,852,1)
exten => 853,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 853,n,Set(__NODEST=)
exten => 853,n,Goto(from-did-direct,853,1)
exten => 855,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 855,n,Set(__NODEST=)
exten => 855,n,Goto(from-did-direct,855,1)
exten => 856,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 856,n,Set(__NODEST=)
exten => 856,n,Goto(from-did-direct,856,1)
exten => 857,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 857,n,Set(__NODEST=)
exten => 857,n,Goto(from-did-direct,857,1)
exten => 858,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 858,n,Set(__NODEST=)
exten => 858,n,Goto(from-did-direct,858,1)
exten => 859,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 859,n,Set(__NODEST=)
exten => 859,n,Goto(from-did-direct,859,1)
exten => 861,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 861,n,Set(__NODEST=)
exten => 861,n,Goto(from-did-direct,861,1)
exten => 862,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 862,n,Set(__NODEST=)
exten => 862,n,Goto(from-did-direct,862,1)
exten => 863,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 863,n,Set(__NODEST=)
exten => 863,n,Goto(from-did-direct,863,1)
exten => 886,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 886,n,Set(__NODEST=)
exten => 886,n,Goto(from-did-direct,886,1)
exten => 919,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 919,n,Set(__NODEST=)
exten => 919,n,Goto(from-did-direct,919,1)
exten => 978,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 978,n,Set(__NODEST=)
exten => 978,n,Goto(from-did-direct,978,1)
exten => 999,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 999,n,Set(__NODEST=)
exten => 999,n,Goto(from-did-direct,999,1)
exten => ${VM_PREFIX}999,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => ${VM_PREFIX}999,n,Set(__NODEST=)
exten => ${VM_PREFIX}999,n,Macro(vm,999,DIRECTDIAL,${IVR_RETVM})
exten => ${VM_PREFIX}999,n,GotoIf($["${IVR_RETVM}" = "RETURN" & "${IVR_CONTEXT}" != ""]?ext-local,vmret,playret)
exten => 8888,1,ExecIf($["${BLKVM_OVERRIDE}" != ""]?Noop(Deleting: ${BLKVM_OVERRIDE}: ${DB_DELETE(${BLKVM_OVERRIDE})}))
exten => 8888,n,Set(__NODEST=)
exten => 8888,n,Goto(from-did-direct,8888,1)

; end of [from-did-direct-ivr]


[ext-trunk]
include => ext-trunk-custom
exten => 1,1,Set(TDIAL_STRING=ZAP/g0)
exten => 1,n,Set(DIAL_TRUNK=1)
exten => 1,n,Goto(ext-trunk,tdial,1)
exten => 2,1,Set(TDIAL_STRING=SIP/88888)
exten => 2,n,Set(DIAL_TRUNK=2)
exten => 2,n,Goto(ext-trunk,tdial,1)
exten => 4,1,Set(TDIAL_STRING=SIP/8675561828726)
exten => 4,n,Set(DIAL_TRUNK=4)
exten => 4,n,Goto(ext-trunk,tdial,1)
exten => 7,1,Set(TDIAL_STRING=SIP/8899)
exten => 7,n,Set(DIAL_TRUNK=7)
exten => 7,n,Goto(ext-trunk,tdial,1)
exten => 8,1,Set(TDIAL_STRING=SIP/8675566630978)
exten => 8,n,Set(DIAL_TRUNK=8)
exten => 8,n,Goto(ext-trunk,tdial,1)
exten => 9,1,Set(TDIAL_STRING=SIP/kamailio)
exten => 9,n,Set(DIAL_TRUNK=9)
exten => 9,n,Goto(ext-trunk,tdial,1)
exten => tdial,1,Set(OUTBOUND_GROUP=OUT_${DIAL_TRUNK})
exten => tdial,n,GotoIf($["${OUTMAXCHANS_${DIAL_TRUNK}}" = ""]?nomax)
exten => tdial,n,GotoIf($[${GROUP_COUNT(OUT_${DIAL_TRUNK})} >= ${OUTMAXCHANS_${DIAL_TRUNK}}]?hangit)
exten => tdial,n(nomax),ExecIf($["${CALLINGPRES_SV}" != ""]?Set(CALLERPRES()=${CALLINGPRES_SV}))
exten => tdial,n,Set(DIAL_NUMBER=${FROM_DID})
exten => tdial,n,GosubIf($["${PREFIX_TRUNK_${DIAL_TRUNK}}" != ""]?sub-flp-${DIAL_TRUNK},s,1)
exten => tdial,n,Set(OUTNUM=${OUTPREFIX_${DIAL_TRUNK}}${DIAL_NUMBER})
exten => tdial,n,Dial(${TDIAL_STRING}/${OUTNUM},300,${DIAL_TRUNK_OPTIONS})
exten => tdial,n,Set(CALLERID(number)=${CALLERID(number):0:40})
exten => tdial,n,Set(CALLERID(name)=${CALLERID(name):0:40})
exten => tdial,n(hangit),Hangup

; end of [ext-trunk]


[from-trunk-sip-88888]
include => from-trunk-sip-88888-custom
exten => _.,1,Set(GROUP()=OUT_2)
exten => _.,n,Goto(from-trunk,${EXTEN},1)

; end of [from-trunk-sip-88888]


[from-trunk-sip-8675561828726]
include => from-trunk-sip-8675561828726-custom
exten => _.,1,Set(GROUP()=OUT_4)
exten => _.,n,Goto(from-trunk,${EXTEN},1)

; end of [from-trunk-sip-8675561828726]


[from-trunk-sip-8899]
include => from-trunk-sip-8899-custom
exten => _.,1,Set(GROUP()=OUT_7)
exten => _.,n,Goto(from-trunk,${EXTEN},1)

; end of [from-trunk-sip-8899]


[from-trunk-sip-8675566630978]
include => from-trunk-sip-8675566630978-custom
exten => _.,1,Set(GROUP()=OUT_8)
exten => _.,n,Goto(from-trunk,${EXTEN},1)

; end of [from-trunk-sip-8675566630978]


[from-trunk-sip-kamailio]
include => from-trunk-sip-kamailio-custom
exten => _.,1,Set(GROUP()=OUT_9)
exten => _.,n,Goto(from-trunk,${EXTEN},1)

; end of [from-trunk-sip-kamailio]


[macro-record-enable]
include => macro-record-enable-custom
exten => s,1,GotoIf($["${BLINDTRANSFER}" = ""]?check)
exten => s,n,ResetCDR(w)
exten => s,n,StopMixMonitor()
exten => s,n(check),ExecIf($["${ARG1}"=""]?MacroExit())
exten => s,n,GotoIf($["${ARG2}"="Group"]?Group:OUT)
exten => s,n(Group),Set(LOOPCNT=${FIELDQTY(ARG1,-)})
exten => s,n,Set(ITER=1)
exten => s,n(begin),GotoIf($["${CUT(DB(AMPUSER/${CUT(ARG1,-,${ITER})}/recording),=,3)}" != "Always"]?continue)
exten => s,n,Set(TEXTEN=${CUT(ARG1,-,${ITER})})
exten => s,n,Noop(Recording enable for ${TEXTEN})
exten => s,n,Set(CALLFILENAME=g${TEXTEN}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID})
exten => s,n,Goto(record)
exten => s,n(continue),Set(ITER=$[${ITER}+1])
exten => s,n,GotoIf($[${ITER}<=${LOOPCNT}]?begin)
exten => s,n(OUT),GotoIf($["${ARG2}"="IN"]?IN)
exten => s,n,ExecIf($["${CUT(DB(AMPUSER/${ARG1}/recording),\\\|,1):4}" != "Always"]?MacroExit())
exten => s,n,Noop(Recording enable for ${ARG1})
exten => s,n,Set(CALLFILENAME=OUT${ARG1}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID})
exten => s,n,Goto(record)
exten => s,n(IN),ExecIf($["${CUT(DB(AMPUSER/${ARG1}/recording),\\\|,2):3}" != "Always"]?MacroExit())
exten => s,n,Noop(Recording enable for ${ARG1})
exten => s,n,Set(CALLFILENAME=${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)}-${UNIQUEID})
exten => s,n(record),MixMonitor(${MIXMON_DIR}${CALLFILENAME}.${MIXMON_FORMAT},,${MIXMON_POST})
exten => s,n,MacroExit()

; end of [macro-record-enable]


[outbound-allroutes]
include => outbound-allroutes-custom
include => outrt-5 ; ims
include => outrt-2 ; normal_outside
include => outrt-1 ; long_outside
include => outrt-3 ; 99_outside
exten => foo,1,Noop(bar)

; end of [outbound-allroutes]


[outrt-5] ; ims
include => outrt-5-custom
exten => _.,1,Macro(user-callerid,SKIPTTL,)
exten => _.,n,Noop(Calling Out Route: ims)
exten => _.,n,Set(MOHCLASS=${IF($["${MOHCLASS}"=""]?default:${MOHCLASS})})
exten => _.,n,Set(_NODEST=)
exten => _.,n,Macro(record-enable,${AMPUSER},OUT,)
exten => _.,n,Macro(dialout-trunk,8,${EXTEN},)
exten => _.,n,Macro(dialout-trunk,4,${EXTEN},)
exten => _.,n,Macro(outisbusy,)

; end of [outrt-5]


[outrt-2] ; normal_outside
include => outrt-2-custom
exten => _.,1,Macro(user-callerid,SKIPTTL,)
exten => _.,n,Noop(Calling Out Route: normal_outside)
exten => _.,n,Set(MOHCLASS=${IF($["${MOHCLASS}"=""]?default:${MOHCLASS})})
exten => _.,n,Set(_NODEST=)
exten => _.,n,Macro(record-enable,${AMPUSER},OUT,)
exten => _.,n,Macro(dialout-trunk,1,${EXTEN},)
exten => _.,n,Macro(outisbusy,)

; end of [outrt-2]


[outrt-1] ; long_outside
include => outrt-1-custom
exten => _0.,1,Macro(user-callerid,SKIPTTL,)
exten => _0.,n,Noop(Calling Out Route: long_outside)
exten => _0.,n,Set(MOHCLASS=${IF($["${MOHCLASS}"=""]?default:${MOHCLASS})})
exten => _0.,n,Set(_NODEST=)
exten => _0.,n,Macro(record-enable,${AMPUSER},OUT,)
exten => _0.,n,Macro(dialout-trunk,1,118080${EXTEN:1},)
exten => _0.,n,Macro(outisbusy,)

; end of [outrt-1]


[outrt-3] ; 99_outside
include => outrt-3-custom
exten => _99.,1,Macro(user-callerid,SKIPTTL,)
exten => _99.,n,Noop(Calling Out Route: 99_outside)
exten => _99.,n,Set(MOHCLASS=${IF($["${MOHCLASS}"=""]?default:${MOHCLASS})})
exten => _99.,n,Set(_NODEST=)
exten => _99.,n,Macro(record-enable,${AMPUSER},OUT,)
exten => _99.,n,Macro(dialout-trunk,1,${EXTEN:2},)
exten => _99.,n,Macro(outisbusy,)

; end of [outrt-3]


[app-blackhole]
include => app-blackhole-custom
exten => hangup,1,Noop(Blackhole Dest: Hangup)
exten => hangup,n,Hangup
exten => zapateller,1,Noop(Blackhole Dest: Play SIT Tone)
exten => zapateller,n,Answer
exten => zapateller,n,Zapateller()
exten => musiconhold,1,Noop(Blackhole Dest: Put caller on hold forever)
exten => musiconhold,n,Answer
exten => musiconhold,n,MusicOnHold()
exten => congestion,1,Noop(Blackhole Dest: Congestion)
exten => congestion,n,Answer
exten => congestion,n,Playtones(congestion)
exten => congestion,n,Congestion(20)
exten => congestion,n,Hangup
exten => busy,1,Noop(Blackhole Dest: Busy)
exten => busy,n,Answer
exten => busy,n,Playtones(busy)
exten => busy,n,Busy(20)
exten => busy,n,Hangup
exten => ring,1,Noop(Blackhole Dest: Ring)
exten => ring,n,Answer
exten => ring,n,Playtones(ring)
exten => ring,n,Wait(300)
exten => ring,n,Hangup

; end of [app-blackhole]


[bad-number]
include => bad-number-custom
exten => _X.,1,ResetCDR()
exten => _X.,n,NoCDR()
exten => _X.,n,Progress
exten => _X.,n,Wait(1)
exten => _X.,n,Progress
exten => _X.,n,Playback(silence/1&cannot-complete-as-dialed&check-number-dial-again,noanswer)
exten => _X.,n,Wait(1)
exten => _X.,n,Congestion(20)
exten => _X.,n,Hangup

; end of [bad-number]


[macro-confirm]
include => macro-confirm-custom
exten => s,1,Set(LOOPCOUNT=0)
exten => s,n,Set(__MACRO_RESULT=ABORT)
exten => s,n,Set(MSG1=${IF($["foo${ARG1}" != "foo"]?${ARG1}:"incoming-call-1-accept-2-decline")})
exten => s,n(start),Background(${MSG1},m,${CHANNEL(language)},macro-confirm)
exten => s,n,Read(INPUT,,1,,,4)
exten => s,n,GotoIf($[${LEN(${INPUT})} > 0]?${INPUT},1:t,1)
exten => 1,1,GotoIf($["${DB_EXISTS(RG/${ARG3}/${UNIQCHAN})}" = "0"]?toolate,1)
exten => 1,n,Noop(Deleting: RG/${ARG3}/${UNIQCHAN} ${DB_DELETE(RG/${ARG3}/${UNIQCHAN})})
exten => 1,n,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => 1,n,Set(__MACRO_RESULT=)
exten => 1,n(exitopt1),MacroExit()
exten => 2,1,Goto(noanswer,1)
exten => 3,1,SayDigits(${CALLCONFIRMCID})
exten => 3,n,GotoIf($["${DB_EXISTS(RG/${ARG3}/${UNIQCHAN})}" = "0"]?toolate,1:s,start)
exten => t,1,GotoIf($["${DB_EXISTS(RG/${ARG3}/${UNIQCHAN})}" = "0"]?toolate,1)
exten => t,n,Set(LOOPCOUNT=$[ ${LOOPCOUNT} + 1 ])
exten => t,n,GotoIf($[ ${LOOPCOUNT} < 5 ]?s,start:noanswer,1)
exten => _X,1,Background(invalid,m,${CHANNEL(language)},macro-confirm)
exten => _X,n,GotoIf($["${DB_EXISTS(RG/${ARG3}/${UNIQCHAN})}" = "0"]?toolate,1)
exten => _X,n,Set(LOOPCOUNT=$[ ${LOOPCOUNT} + 1 ])
exten => _X,n,GotoIf($[ ${LOOPCOUNT} < 5 ]?s,start:noanswer,1)
exten => noanswer,1,Set(__MACRO_RESULT=ABORT)
exten => noanswer,n(exitnoanswer),MacroExit()
exten => toolate,1,Set(MSG2=${IF($["foo${ARG2}" != "foo"]?${ARG2}:"incoming-call-no-longer-avail")})
exten => toolate,n,Playback(${MSG2})
exten => toolate,n,Set(__MACRO_RESULT=ABORT)
exten => toolate,n(exittoolate),MacroExit()
exten => h,1,Macro(hangupcall,)

; end of [macro-confirm]


[macro-auto-confirm]
include => macro-auto-confirm-custom
exten => s,1,Set(__MACRO_RESULT=)
exten => s,n,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => s,n,Noop(Deleting: RG/${ARG1}/${UNIQCHAN} ${DB_DELETE(RG/${ARG1}/${UNIQCHAN})})

; end of [macro-auto-confirm]


[macro-auto-blkvm]
include => macro-auto-blkvm-custom
exten => s,1,Set(__MACRO_RESULT=)
exten => s,n,Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})

; end of [macro-auto-blkvm]


[sub-pincheck]
include => sub-pincheck-custom
exten => s,1,Authenticate(${ARG3},)
exten => s,n,ResetCDR()
exten => s,n,Return()

; end of [sub-pincheck]


[macro-dialout-trunk]
include => macro-dialout-trunk-custom
exten => s,1,Set(DIAL_TRUNK=${ARG1})
exten => s,n,GosubIf($[$["${ARG3}" != ""] & $["${DB(AMPUSER/${AMPUSER}/pinless)}" != "NOPASSWD"]]?sub-pincheck,s,1)
exten => s,n,GotoIf($["x${OUTDISABLE_${DIAL_TRUNK}}" = "xon"]?disabletrunk,1)
exten => s,n,Set(DIAL_NUMBER=${ARG2})
exten => s,n,Set(DIAL_TRUNK_OPTIONS=${DIAL_OPTIONS})
exten => s,n,Set(OUTBOUND_GROUP=OUT_${DIAL_TRUNK})
exten => s,n,GotoIf($["${OUTMAXCHANS_${DIAL_TRUNK}}foo" = "foo"]?nomax)
exten => s,n,GotoIf($[ ${GROUP_COUNT(OUT_${DIAL_TRUNK})} >= ${OUTMAXCHANS_${DIAL_TRUNK}} ]?chanfull)
exten => s,n(nomax),GotoIf($["${INTRACOMPANYROUTE}" = "YES"]?skipoutcid)
exten => s,n,Set(DIAL_TRUNK_OPTIONS=${TRUNK_OPTIONS})
exten => s,n,Macro(outbound-callerid,${DIAL_TRUNK})
exten => s,n(skipoutcid),GosubIf($["${PREFIX_TRUNK_${DIAL_TRUNK}}" != ""]?sub-flp-${DIAL_TRUNK},s,1)
exten => s,n,Set(OUTNUM=${OUTPREFIX_${DIAL_TRUNK}}${DIAL_NUMBER})
exten => s,n,Set(custom=${CUT(OUT_${DIAL_TRUNK},:,1)})
exten => s,n,ExecIf($[$["${MOHCLASS}" != "default"] & $["${MOHCLASS}" != ""]]?Set(DIAL_TRUNK_OPTIONS=M(setmusic^${MOHCLASS})${DIAL_TRUNK_OPTIONS}))
exten => s,n(gocall),Macro(dialout-trunk-predial-hook,)
exten => s,n,GotoIf($["${PREDIAL_HOOK_RET}" = "BYPASS"]?bypass,1)
exten => s,n,GotoIf($["${custom}" = "AMP"]?customtrunk)
exten => s,n,Dial(${OUT_${DIAL_TRUNK}}/${OUTNUM},300,${DIAL_TRUNK_OPTIONS})
exten => s,n,Noop(Dial failed for some reason with DIALSTATUS = ${DIALSTATUS} and HANGUPCAUSE = ${HANGUPCAUSE})
exten => s,n,Goto(s-${DIALSTATUS},1)
exten => s,n(customtrunk),Set(pre_num=${CUT(OUT_${DIAL_TRUNK},$,1)})
exten => s,n,Set(the_num=${CUT(OUT_${DIAL_TRUNK},$,2)})
exten => s,n,Set(post_num=${CUT(OUT_${DIAL_TRUNK},$,3)})
exten => s,n,GotoIf($["${the_num}" = "OUTNUM"]?outnum:skipoutnum)
exten => s,n(outnum),Set(the_num=${OUTNUM})
exten => s,n(skipoutnum),Dial(${pre_num:4}${the_num}${post_num},300,${DIAL_TRUNK_OPTIONS})
exten => s,n,Noop(Dial failed for some reason with DIALSTATUS = ${DIALSTATUS} and HANGUPCAUSE = ${HANGUPCAUSE})
exten => s,n,Goto(s-${DIALSTATUS},1)
exten => s,n(chanfull),Noop(max channels used up)
exten => s-BUSY,1,Noop(Dial failed due to trunk reporting BUSY - giving up)
exten => s-BUSY,n,Playtones(busy)
exten => s-BUSY,n,Busy(20)
exten => s-ANSWER,1,Noop(Call successfully answered - Hanging up now)
exten => s-ANSWER,n,Macro(hangupcall,)
exten => s-NOANSWER,1,Noop(Dial failed due to trunk reporting NOANSWER - giving up)
exten => s-NOANSWER,n,Progress
exten => s-NOANSWER,n,Playback(number-not-answering,noanswer)
exten => s-NOANSWER,n,Congestion(20)
exten => s-INVALIDNMBR,1,Noop(Dial failed due to trunk reporting Address Incomplete - giving up)
exten => s-INVALIDNMBR,n,Progress
exten => s-INVALIDNMBR,n,Playback(ss-noservice,noanswer)
exten => s-INVALIDNMBR,n,Busy(20)
exten => s-CHANGED,1,Noop(Dial failed due to trunk reporting Number Changed - giving up)
exten => s-CHANGED,n,Playtones(busy)
exten => s-CHANGED,n,Busy(20)
exten => _s-.,1,Set(RC=${IF($[${ISNULL(${HANGUPCAUSE})}]?0:${HANGUPCAUSE})})
exten => _s-.,n,Goto(${RC},1)
exten => 17,1,Goto(s-BUSY,1)
exten => 18,1,Goto(s-NOANSWER,1)
exten => 22,1,Goto(s-CHANGED,1)
exten => 23,1,Goto(s-CHANGED,1)
exten => 28,1,Goto(s-INVALIDNMBR,1)
exten => _X,1,Goto(continue,1)
exten => _X.,1,Goto(continue,1)
exten => continue,1,GotoIf($["${OUTFAIL_${ARG1}}" = ""]?noreport)
exten => continue,n,AGI(${OUTFAIL_${ARG1}})
exten => continue,n(noreport),Noop(TRUNK Dial failed due to ${DIALSTATUS} HANGUPCAUSE: ${HANGUPCAUSE} - failing through to other trunks)
exten => continue,n,Set(CALLERID(number)=${AMPUSER})
exten => disabletrunk,1,Noop(TRUNK: ${OUT_${DIAL_TRUNK}} DISABLED - falling through to next trunk)
exten => bypass,1,Noop(TRUNK: ${OUT_${DIAL_TRUNK}} BYPASSING because dialout-trunk-predial-hook)
exten => h,1,Macro(hangupcall,)

; end of [macro-dialout-trunk]


[macro-dialout-dundi]
include => macro-dialout-dundi-custom
exten => s,1,Set(DIAL_TRUNK=${ARG1})
exten => s,n,GosubIf($[$["${ARG3}" != ""] & $["${DB(AMPUSER/${AMPUSER}/pinless)}" != "NOPASSWD"]]?sub-pincheck,s,1)
exten => s,n,GotoIf($["x${OUTDISABLE_${DIAL_TRUNK}}" = "xon"]?disabletrunk,1)
exten => s,n,Set(DIAL_NUMBER=${ARG2})
exten => s,n,Set(DIAL_TRUNK_OPTIONS=${DIAL_OPTIONS})
exten => s,n,Set(OUTBOUND_GROUP=OUT_${DIAL_TRUNK})
exten => s,n,GotoIf($["${OUTMAXCHANS_${DIAL_TRUNK}}foo" = "foo"]?nomax)
exten => s,n,GotoIf($[ ${GROUP_COUNT(OUT_${DIAL_TRUNK})} >= ${OUTMAXCHANS_${DIAL_TRUNK}} ]?chanfull)
exten => s,n(nomax),GotoIf($["${INTRACOMPANYROUTE}" = "YES"]?skipoutcid)
exten => s,n,Set(DIAL_TRUNK_OPTIONS=${TRUNK_OPTIONS})
exten => s,n,Macro(outbound-callerid,${DIAL_TRUNK})
exten => s,n(skipoutcid),GosubIf($["${PREFIX_TRUNK_${DIAL_TRUNK}}" != ""]?sub-flp-${DIAL_TRUNK},s,1)
exten => s,n,Set(OUTNUM=${OUTPREFIX_${DIAL_TRUNK}}${DIAL_NUMBER})
exten => s,n,ExecIf($[$["${MOHCLASS}" != "default"] & $["${MOHCLASS}" != ""]]?Set(DIAL_TRUNK_OPTIONS=M(setmusic^${MOHCLASS})${DIAL_TRUNK_OPTIONS}))
exten => s,n(gocall),Macro(dialout-dundi-predial-hook,)
exten => s,n,GotoIf($["${PREDIAL_HOOK_RET}" = "BYPASS"]?bypass,1)
exten => s,n,Macro(dundi-${DIAL_TRUNK},${OUTNUM})
exten => s,n,Goto(s-${DIALSTATUS},1)
exten => s,n(chanfull),Noop(max channels used up)
exten => s-BUSY,1,Noop(Dial failed due to trunk reporting BUSY - giving up)
exten => s-BUSY,n,Playtones(busy)
exten => s-BUSY,n,Busy(20)
exten => s-ANSWER,1,Noop(Call successfully answered - Hanging up now)
exten => s-ANSWER,n,Macro(hangupcall,)
exten => s-NOANSWER,1,Noop(Dial failed due to trunk reporting NOANSWER - giving up)
exten => s-NOANSWER,n,Progress
exten => s-NOANSWER,n,Playback(number-not-answering,noanswer)
exten => s-NOANSWER,n,Congestion(20)
exten => s-INVALIDNMBR,1,Noop(Dial failed due to trunk reporting Address Incomplete - giving up)
exten => s-INVALIDNMBR,n,Progress
exten => s-INVALIDNMBR,n,Playback(ss-noservice,noanswer)
exten => s-INVALIDNMBR,n,Busy(20)
exten => s-CHANGED,1,Noop(Dial failed due to trunk reporting Number Changed - giving up)
exten => s-CHANGED,n,Playtones(busy)
exten => s-CHANGED,n,Busy(20)
exten => _s-.,1,Set(RC=${IF($[${ISNULL(${HANGUPCAUSE})}]?0:${HANGUPCAUSE})})
exten => _s-.,n,Goto(${RC},1)
exten => 17,1,Goto(s-BUSY,1)
exten => 18,1,Goto(s-NOANSWER,1)
exten => 22,1,Goto(s-CHANGED,1)
exten => 23,1,Goto(s-CHANGED,1)
exten => 28,1,Goto(s-INVALIDNMBR,1)
exten => _X,1,Goto(continue,1)
exten => _X.,1,Goto(continue,1)
exten => continue,1,GotoIf($["${OUTFAIL_${ARG1}}" = ""]?noreport)
exten => continue,n,AGI(${OUTFAIL_${ARG1}})
exten => continue,n(noreport),Noop(TRUNK Dial failed due to ${DIALSTATUS} HANGUPCAUSE: ${HANGUPCAUSE} - failing through to other trunks)
exten => continue,n,Set(CALLERID(number)=${AMPUSER})
exten => disabletrunk,1,Noop(TRUNK: ${OUT_${DIAL_TRUNK}} DISABLED - falling through to next trunk)
exten => bypass,1,Noop(TRUNK: ${OUT_${DIAL_TRUNK}} BYPASSING because dialout-dundi-predial-hook)
exten => h,1,Macro(hangupcall,)

; end of [macro-dialout-dundi]


[macro-user-callerid]
include => macro-user-callerid-custom
exten => s,1,Set(AMPUSER=${IF($["foo${AMPUSER}" = "foo"]?${CALLERID(number)}:${AMPUSER})})
exten => s,n,GotoIf($["${CHANNEL:0:5}" = "Local"]?report)
exten => s,n,ExecIf($["${REALCALLERIDNUM:1:2}" = ""]?Set(REALCALLERIDNUM=${CALLERID(number)}))
exten => s,n,Set(AMPUSER=${DB(DEVICE/${REALCALLERIDNUM}/user)})
exten => s,n,Set(AMPUSERCIDNAME=${DB(AMPUSER/${AMPUSER}/cidname)})
exten => s,n,GotoIf($["x${AMPUSERCIDNAME:1:2}" = "x"]?report)
exten => s,n,Set(AMPUSERCID=${IF($["${DB_EXISTS(AMPUSER/${AMPUSER}/cidnum)}" = "1"]?${DB_RESULT}:${AMPUSER})})
exten => s,n,Set(CALLERID(all)="${AMPUSERCIDNAME}" <${AMPUSERCID}>)
exten => s,n,ExecIf($["${DB(AMPUSER/${AMPUSER}/language)}" != ""]?Set(CHANNEL(language)=${DB(AMPUSER/${AMPUSER}/language)}))
exten => s,n(report),GotoIf($[ "${ARG1}" = "SKIPTTL" ]?continue)
exten => s,n(report2),Set(__TTL=${IF($["foo${TTL}" = "foo"]?64:$[ ${TTL} - 1 ])})
exten => s,n,GotoIf($[ ${TTL} > 0 ]?continue)
exten => s,n,Wait(${RINGTIMER})
exten => s,n,Answer
exten => s,n,Wait(2)
exten => s,n,Playback(im-sorry&an-error-has-occured&with&call-forwarding)
exten => s,n,Macro(hangupcall,)
exten => s,n,Congestion(20)
exten => s,n(continue),Set(CALLERID(number)=${CALLERID(number):0:40})
exten => s,n,Set(CALLERID(name)=${CALLERID(name):0:40})
exten => s,n,Noop(Using CallerID ${CALLERID(all)})
exten => h,1,Macro(hangupcall,)

; end of [macro-user-callerid]


[macro-dialout-enum]
include => macro-dialout-enum-custom
exten => s,1,GosubIf($[$["${ARG3}" != ""] & $["${DB(AMPUSER/${AMPUSER}/pinless)}" != "NOPASSWD"]]?sub-pincheck,s,1)
exten => s,n,Macro(outbound-callerid,${ARG1})
exten => s,n,Set(OUTBOUND_GROUP=OUT_${ARG1})
exten => s,n,GotoIf($["${OUTMAXCHANS_${ARG1}}foo" = "foo"]?nomax)
exten => s,n,GotoIf($[ ${GROUP_COUNT(OUT_${ARG1})} >= ${OUTMAXCHANS_${ARG1}} ]?nochans)
exten => s,n(nomax),Set(DIAL_NUMBER=${ARG2})
exten => s,n,Set(DIAL_TRUNK=${ARG1})
exten => s,n,GosubIf($["${PREFIX_TRUNK_${DIAL_TRUNK}}" != ""]?sub-flp-${DIAL_TRUNK},s,1)
exten => s,n,AGI(enumlookup.agi)
exten => s,n(dialloop),GotoIf($["foo${DIALARR}"="foo"]?s-${DIALSTATUS},1)
exten => s,n,Set(TRYDIAL=${CUT(DIALARR,%,1)})
exten => s,n,Set(DIALARR=${CUT(DIALARR,%,2-)})
exten => s,n,Dial(${TRYDIAL},)
exten => s,n,GotoIf($[ $[ "${DIALSTATUS}" = "CHANUNAVAIL" ] | $[ "${DIALSTATUS}" = "CONGESTION" ] ]?dialloop:s-${DIALSTATUS},1)
exten => s,n(nochans),Noop(max channels used up)
exten => s-BUSY,1,Noop(Dial failed due to trunk reporting BUSY - giving up)
exten => s-BUSY,n,Playtones(busy)
exten => s-BUSY,n,Busy(20)
exten => s-ANSWER,1,Noop(Call successfully answered - Hanging up now)
exten => s-ANSWER,n,Macro(hangupcall,)
exten => s-NOANSWER,1,Noop(Dial failed due to trunk reporting NOANSWER - giving up)
exten => s-NOANSWER,n,Progress
exten => s-NOANSWER,n,Playback(number-not-answering,noanswer)
exten => s-NOANSWER,n,Congestion(20)
exten => s-INVALIDNMBR,1,Noop(Dial failed due to trunk reporting Address Incomplete - giving up)
exten => s-INVALIDNMBR,n,Progress
exten => s-INVALIDNMBR,n,Playback(ss-noservice,noanswer)
exten => s-INVALIDNMBR,n,Busy(20)
exten => s-CHANGED,1,Noop(Dial failed due to trunk reporting Number Changed - giving up)
exten => s-CHANGED,n,Playtones(busy)
exten => s-CHANGED,n,Busy(20)
exten => _s-.,1,Set(RC=${IF($[${ISNULL(${HANGUPCAUSE})}]?0:${HANGUPCAUSE})})
exten => _s-.,n,Goto(${RC},1)
exten => 17,1,Goto(s-BUSY,1)
exten => 18,1,Goto(s-NOANSWER,1)
exten => 22,1,Goto(s-CHANGED,1)
exten => 23,1,Goto(s-CHANGED,1)
exten => 28,1,Goto(s-INVALIDNMBR,1)
exten => _X,1,Goto(continue,1)
exten => _X.,1,Goto(continue,1)
exten => continue,1,GotoIf($["${OUTFAIL_${ARG1}}" = ""]?noreport)
exten => continue,n,AGI(${OUTFAIL_${ARG1}})
exten => continue,n(noreport),Noop(TRUNK Dial failed due to ${DIALSTATUS} HANGUPCAUSE: ${HANGUPCAUSE} - failing through to other trunks)
exten => continue,n,Set(CALLERID(number)=${AMPUSER})
exten => disabletrunk,1,Noop(TRUNK: ${OUT_${DIAL_TRUNK}} DISABLED - falling through to next trunk)
exten => bypass,1,Noop(TRUNK: ${OUT_${DIAL_TRUNK}} BYPASSING because dialout-trunk-predial-hook)
exten => h,1,Macro(hangupcall,)

; end of [macro-dialout-enum]


[macro-outbound-callerid]
include => macro-outbound-callerid-custom
exten => s,1,ExecIf($["${CALLINGPRES_SV}" != ""]?Set(CALLERPRES()=${CALLINGPRES_SV}))
exten => s,n,ExecIf($["${REALCALLERIDNUM:1:2}" = ""]?Set(REALCALLERIDNUM=${CALLERID(number)}))
exten => s,n(start),GotoIf($[ $["${REALCALLERIDNUM}" = ""] | $["${KEEPCID}" != "TRUE"] | $["${OUTKEEPCID_${ARG1}}" = "on"] ]?normcid)
exten => s,n,Set(USEROUTCID=${REALCALLERIDNUM})
exten => s,n,GotoIf($["foo${DB(AMPUSER/${REALCALLERIDNUM}/device)}" = "foo"]?bypass)
exten => s,n(normcid),Set(USEROUTCID=${DB(AMPUSER/${AMPUSER}/outboundcid)})
exten => s,n(bypass),Set(EMERGENCYCID=${DB(DEVICE/${REALCALLERIDNUM}/emergency_cid)})
exten => s,n,Set(TRUNKOUTCID=${OUTCID_${ARG1}})
exten => s,n,GotoIf($["${EMERGENCYROUTE:1:2}" = "" | "${EMERGENCYCID:1:2}" = ""]?trunkcid)
exten => s,n,Set(CALLERID(all)=${EMERGENCYCID})
exten => s,n(exit),MacroExit()
exten => s,n(trunkcid),ExecIf($[${LEN(${TRUNKOUTCID})} != 0]?Set(CALLERID(all)=${TRUNKOUTCID}))
exten => s,n(usercid),ExecIf($[${LEN(${USEROUTCID})} != 0]?Set(CALLERID(all)=${USEROUTCID}))
exten => s,n,ExecIf($[${LEN(${TRUNKCIDOVERRIDE})} != 0 | ${LEN(${FORCEDOUTCID_${ARG1}})} != 0]?Set(CALLERID(all)=${IF($[${LEN(${FORCEDOUTCID_${ARG1}})}=0]?${TRUNKCIDOVERRIDE}:${FORCEDOUTCID_${ARG1}})}))
exten => s,n(hidecid),ExecIf($["${CALLERID(name)}"="hidden"]?Set(CALLERPRES()=prohib_passed_screen))

; end of [macro-outbound-callerid]


[from-zaptel]
include => from-zaptel-custom
include => from-dahdi
exten => foo,1,Noop(bar)

; end of [from-zaptel]


[from-dahdi]
include => from-dahdi-custom
exten => _X.,1,Set(DID=${EXTEN})
exten => _X.,n,Goto(s,1)
exten => s,1,Noop(Entering from-dahdi with DID == ${DID})
exten => s,n,Ringing()
exten => s,n,Set(DID=${IF($["${DID}"= ""]?s:${DID})})
exten => s,n,Noop(DID is now ${DID})
exten => s,n,GotoIf($["${CHANNEL:0:5}"="DAHDI"]?dahdiok:checkzap)
exten => s,n(checkzap),GotoIf($["${CHANNEL:0:3}"="Zap"]?zapok:neither)
exten => s,n(neither),Goto(from-pstn,${DID},1)
exten => s,n,Macro(Hangupcall,dummy)
exten => s,n(dahdiok),Noop(Is a DAHDI Channel)
exten => s,n,Set(CHAN=${CHANNEL:6})
exten => s,n,Set(CHAN=${CUT(CHAN,-,1)})
exten => s,n,Macro(from-dahdi-${CHAN},${DID},1)
exten => s,n,Noop(Returned from Macro from-dahdi-${CHAN})
exten => s,n,Goto(from-pstn,${DID},1)
exten => s,n(zapok),Noop(Is a Zaptel Channel)
exten => s,n,Set(CHAN=${CHANNEL:4})
exten => s,n,Set(CHAN=${CUT(CHAN,-,1)})
exten => s,n,Macro(from-dahdi-${CHAN},${DID},1)
exten => s,n,Noop(Returned from Macro from-dahdi-${CHAN})
exten => s,n,Goto(from-pstn,${DID},1)

; end of [from-dahdi]


[vm-callme]
include => vm-callme-custom
exten => s,1,Answer
exten => s,n,Wait(1)
exten => s,n(repeat),Background(${MSG}&silence/2&vm-repeat&vm-starmain)
exten => s,n,WaitExten(15,)
exten => 5,1,Goto(s,repeat)
exten => #,1,Playback(vm-goodbye)
exten => #,n,Hangup
exten => *,1,Macro(get-vmcontext,${MBOX})
exten => *,n,VoiceMailMain(${MBOX}@${VMCONTEXT},s)
exten => i,1,Playback(pm-invalid-option)
exten => i,n,Goto(s,repeat)
exten => t,1,Playback(vm-goodbye)
exten => t,n,Hangup
exten => h,1,Hangup
exten => s-ANSWER,1,Noop(Call successfully answered - Hanging up now)
exten => s-ANSWER,n,Macro(hangupcall,)

; end of [vm-callme]


[macro-vm]
include => macro-vm-custom
exten => s,1,Macro(user-callerid,SKIPTTL)
exten => s,n,Set(VMGAIN=${IF($["foo${VM_GAIN}"!="foo"]?"g(${VM_GAIN})":"")})
exten => s,n,GotoIf($["foo${DB(${BLKVM_OVERRIDE})}" != "fooTRUE"]?vmx,1)
exten => s,n,Noop(CAME FROM: ${NODEST} - Blocking VM cause of key: ${DB(BLKVM_OVERRIDE)})
exten => s,n,Hangup
exten => vmx,1,Set(MEXTEN=${ARG1})
exten => vmx,n,Set(MMODE=${ARG2})
exten => vmx,n,Set(RETVM=${ARG3})
exten => vmx,n,Set(MODE=${IF($["${MMODE}"="BUSY"]?busy:unavail)})
exten => vmx,n,GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/vmxopts/timeout)}" = "0"]?chknomsg)
exten => vmx,n,Set(VM_OPTS=${DB_RESULT})
exten => vmx,n(chknomsg),GotoIf($["${MMODE}"="NOMESSAGE"]?s-${MMODE},1)
exten => vmx,n,GotoIf($["${MMODE}" != "DIRECTDIAL"]?notdirect)
exten => vmx,n,Set(MODE=${IF($["${REGEX("[b]" ${VM_DDTYPE})}" = "1"]?busy:${MODE})})
exten => vmx,n(notdirect),Noop(Checking if ext ${MEXTEN} is enabled: ${DB(AMPUSER/${MEXTEN}/vmx/${MODE}/state)})
exten => vmx,n,GotoIf($["${DB(AMPUSER/${MEXTEN}/vmx/${MODE}/state)}" != "enabled"]?s-${MMODE},1)
exten => vmx,n,Macro(get-vmcontext,${MEXTEN})
exten => vmx,n,GotoIf($[(${STAT(f,${ASTSPOOLDIR}/voicemail/${VMCONTEXT}/${MEXTEN}/temp.wav)} = 1) || (${STAT(f,${ASTSPOOLDIR}/voicemail/${VMCONTEXT}/${MEXTEN}/temp.WAV)} = 1)]?tmpgreet)
exten => vmx,n,GotoIf($[(${STAT(f,${ASTSPOOLDIR}/voicemail/${VMCONTEXT}/${MEXTEN}/${MODE}.wav)} = 0) && (${STAT(f,${ASTSPOOLDIR}/voicemail/${VMCONTEXT}/${MEXTEN}/${MODE}.WAV)} = 0)]?nofile)
exten => vmx,n,Set(LOOPCOUNT=0)
exten => vmx,n,GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/repeat)}" = "0"]?vmxtime)
exten => vmx,n,Set(VMX_REPEAT=${DB_RESULT})
exten => vmx,n(vmxtime),GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/timeout)}" = "0"]?vmxloops)
exten => vmx,n,Set(VMX_TIMEOUT=${DB_RESULT})
exten => vmx,n(vmxloops),GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/loops)}" = "0"]?vmxanswer)
exten => vmx,n,Set(VMX_LOOPS=${DB_RESULT})
exten => vmx,n(vmxanswer),Answer
exten => vmx,n(loopstart),Read(ACTION,${ASTSPOOLDIR}/voicemail/${VMCONTEXT}/${MEXTEN}/${MODE},1,skip,${VMX_REPEAT},${VMX_TIMEOUT})
exten => vmx,n,GotoIf($["${EXISTS(${ACTION})}" = "1"]?checkopt)
exten => vmx,n(noopt),Noop(Timeout: going to timeout dest)
exten => vmx,n,Set(VMX_OPTS=${VMX_OPTS_TIMEOUT})
exten => vmx,n,GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/vmxopts/timeout)}" = "0"]?chktime)
exten => vmx,n,Set(VMX_OPTS=${DB_RESULT})
exten => vmx,n(chktime),GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/timedest/ext)}" = "0"]?dotime)
exten => vmx,n,Set(VMX_TIMEDEST_EXT=${DB_RESULT})
exten => vmx,n,GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/timedest/context)}" = "0"]?timepri)
exten => vmx,n,Set(VMX_TIMEDEST_CONTEXT=${DB_RESULT})
exten => vmx,n(timepri),GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/timedest/pri)}" = "0"]?dotime)
exten => vmx,n,Set(VMX_TIMEDEST_PRI=${DB_RESULT})
exten => vmx,n(dotime),Goto(${VMX_TIMEDEST_CONTEXT},${VMX_TIMEDEST_EXT},${VMX_TIMEDEST_PRI})
exten => vmx,n(checkopt),GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/${ACTION}/ext)}" = "1"]?doopt)
exten => vmx,n,GotoIf($["${ACTION}" = "0"]?o,1)
exten => vmx,n,GotoIf($["${ACTION}" = "*"]?adef,1)
exten => vmx,n,Set(LOOPCOUNT=$[${LOOPCOUNT} + 1])
exten => vmx,n,GotoIf($[${LOOPCOUNT} > ${VMX_LOOPS}]?toomany)
exten => vmx,n,Playback(pm-invalid-option&please-try-again)
exten => vmx,n,Goto(loopstart)
exten => vmx,n(toomany),Noop(Too Many invalid entries, got to invalid dest)
exten => vmx,n,Set(VMX_OPTS=${VMX_OPTS_LOOPS})
exten => vmx,n,GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/vmxopts/loops)}" = "0"]?chkloop)
exten => vmx,n,Set(VMX_OPTS=${DB_RESULT})
exten => vmx,n(chkloop),GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/loopdest/ext)}" = "0"]?doloop)
exten => vmx,n,Set(VMX_LOOPDEST_EXT=${DB_RESULT})
exten => vmx,n,GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/loopdest/context)}" = "0"]?looppri)
exten => vmx,n,Set(VMX_LOOPDEST_CONTEXT=${DB_RESULT})
exten => vmx,n(looppri),GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/loopdest/pri)}" = "0"]?doloop)
exten => vmx,n,Set(VMX_LOOPDEST_PRI=${DB_RESULT})
exten => vmx,n(doloop),Goto(${VMX_LOOPDEST_CONTEXT},${VMX_LOOPDEST_EXT},${VMX_LOOPDEST_PRI})
exten => vmx,n(doopt),Noop(Got a valid option: ${DB_RESULT})
exten => vmx,n,Set(VMX_EXT=${DB_RESULT})
exten => vmx,n,GotoIf($["${VMX_EXT}" != "dovm"]?getdest)
exten => vmx,n(vmxopts),Set(VMX_OPTS=${VMX_OPTS_DOVM})
exten => vmx,n,GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/vmxopts/dovm)}" = "0"]?vmxdovm)
exten => vmx,n(vmxopts),Set(VMX_OPTS=${DB_RESULT})
exten => vmx,n(vmxdovm),Goto(dovm,1)
exten => vmx,n(getdest),GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/${ACTION}/context)}" = "0"]?vmxpri)
exten => vmx,n,Set(VMX_CONTEXT=${DB_RESULT})
exten => vmx,n(vmxpri),GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/${ACTION}/pri)}" = "0"]?vmxgoto)
exten => vmx,n,Set(VMX_PRI=${DB_RESULT})
exten => vmx,n(vmxgoto),Goto(${VMX_CONTEXT},${VMX_EXT},${VMX_PRI})
exten => vmx,n(nofile),Noop(File for mode: ${MODE} does not exist, SYSTEMSTATUS: ${SYSTEMSTATUS}, going to normal voicemail)
exten => vmx,n,Goto(s-${MMODE},1)
exten => vmx,n(tmpgreet),Noop(Temporary Greeting Detected, going to normal voicemail)
exten => vmx,n,Goto(s-${MMODE},1)
exten => dovm,1,Noop(VMX Timeout - go to voicemail)
exten => dovm,n,VoiceMail(${MEXTEN}@${VMCONTEXT},${VMX_OPTS}${VMGAIN})
exten => dovm,n,Goto(exit-${VMSTATUS},1)
exten => s-BUSY,1,Noop(BUSY voicemail)
exten => s-BUSY,n,Macro(get-vmcontext,${MEXTEN})
exten => s-BUSY,n,VoiceMail(${MEXTEN}@${VMCONTEXT},${VM_OPTS}b${VMGAIN})
exten => s-BUSY,n,Goto(exit-${VMSTATUS},1)
exten => s-NOMESSAGE,1,Noop(NOMESSAGE (beeb only) voicemail)
exten => s-NOMESSAGE,n,Macro(get-vmcontext,${MEXTEN})
exten => s-NOMESSAGE,n,VoiceMail(${MEXTEN}@${VMCONTEXT},s${VM_OPTS}${VMGAIN})
exten => s-NOMESSAGE,n,Goto(exit-${VMSTATUS},1)
exten => s-DIRECTDIAL,1,Noop(DIRECTDIAL voicemail)
exten => s-DIRECTDIAL,n,Macro(get-vmcontext,${MEXTEN})
exten => s-DIRECTDIAL,n,VoiceMail(${MEXTEN}@${VMCONTEXT},${VM_OPTS}${VM_DDTYPE}${VMGAIN})
exten => s-DIRECTDIAL,n,Goto(exit-${VMSTATUS},1)
exten => _s-.,1,Macro(get-vmcontext,${MEXTEN})
exten => _s-.,n,VoiceMail(${MEXTEN}@${VMCONTEXT},${VM_OPTS}u${VMGAIN})
exten => _s-.,n,Goto(exit-${VMSTATUS},1)
exten => o,1,Playback(one-moment-please)
exten => o,n,GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/0/ext)}" = "0"]?doopdef)
exten => o,n,Set(VMX_OPDEST_EXT=${DB_RESULT})
exten => o,n,GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/0/context)}" = "1"]?opcontext)
exten => o,n,Set(DB_RESULT=${VMX_CONTEXT})
exten => o,n(opcontext),Set(VMX_OPDEST_CONTEXT=${DB_RESULT})
exten => o,n,GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/0/pri)}" = "1"]?oppri)
exten => o,n,Set(DB_RESULT=${VMX_PRI})
exten => o,n(oppri),Set(VMX_OPDEST_PRI=${DB_RESULT})
exten => o,n,Goto(${VMX_OPDEST_CONTEXT},${VMX_OPDEST_EXT},${VMX_OPDEST_PRI})
exten => o,n(doopdef),GotoIf($["x${OPERATOR_XTN}"="x"]?nooper:from-internal,${OPERATOR_XTN},1)
exten => o,n(nooper),GotoIf($["x${FROM_DID}"="x"]?nodid)
exten => o,n,Dial(Local/${FROM_DID}@from-pstn,)
exten => o,n,Macro(hangup,)
exten => o,n(nodid),Dial(Local/s@from-pstn,)
exten => o,n,Macro(hangup,)
exten => a,1,Macro(get-vmcontext,${MEXTEN})
exten => a,n,GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/*/ext)}" = "0"]?adef,1)
exten => a,n,Set(VMX_ADEST_EXT=${DB_RESULT})
exten => a,n,GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/*/context)}" = "1"]?acontext)
exten => a,n,Set(DB_RESULT=${VMX_CONTEXT})
exten => a,n(acontext),Set(VMX_ADEST_CONTEXT=${DB_RESULT})
exten => a,n,GotoIf($["${DB_EXISTS(AMPUSER/${MEXTEN}/vmx/${MODE}/*/pri)}" = "1"]?apri)
exten => a,n,Set(DB_RESULT=${VMX_PRI})
exten => a,n(apri),Set(VMX_ADEST_PRI=${DB_RESULT})
exten => a,n,Goto(${VMX_ADEST_CONTEXT},${VMX_ADEST_EXT},${VMX_ADEST_PRI})
exten => adef,1,VoiceMailMain(${MEXTEN}@${VMCONTEXT})
exten => adef,n,GotoIf($["${RETVM}" = "RETURN"]?exit-RETURN,1)
exten => adef,n,Hangup
exten => exit-FAILED,1,Playback(im-sorry&an-error-has-occured)
exten => exit-FAILED,n,GotoIf($["${RETVM}" = "RETURN"]?exit-RETURN,1)
exten => exit-FAILED,n,Hangup
exten => exit-SUCCESS,1,GotoIf($["${RETVM}" = "RETURN"]?exit-RETURN,1)
exten => exit-SUCCESS,n,Playback(goodbye)
exten => exit-SUCCESS,n,Hangup
exten => exit-USEREXIT,1,GotoIf($["${RETVM}" = "RETURN"]?exit-RETURN,1)
exten => exit-USEREXIT,n,Playback(goodbye)
exten => exit-USEREXIT,n,Hangup
exten => exit-RETURN,1,Noop(Returning From Voicemail because macro)
exten => t,1,Hangup

; end of [macro-vm]


[macro-exten-vm]
include => macro-exten-vm-custom
exten => s,1,Macro(user-callerid,)
exten => s,n,Set(RingGroupMethod=none)
exten => s,n,Set(VMBOX=${ARG1})
exten => s,n,Set(__EXTTOCALL=${ARG2})
exten => s,n,Set(CFUEXT=${DB(CFU/${EXTTOCALL})})
exten => s,n,Set(CFBEXT=${DB(CFB/${EXTTOCALL})})
exten => s,n,Set(RT=${IF($[$["${VMBOX}"!="novm"] | $["${CFUEXT}"!=""]]?${RINGTIMER}:"")})
exten => s,n(checkrecord),Macro(record-enable,${EXTTOCALL},IN)
exten => s,n(macrodial),Macro(dial-one,${RT},${DIAL_OPTIONS},${EXTTOCALL})
exten => s,n,GotoIf($["${VMBOX}"!="novm" & "${SCREEN}"!="" & "${DIALSTATUS}"="NOANSWER"]?exit)
exten => s,n,Set(SV_DIALSTATUS=${DIALSTATUS})
exten => s,n(calldocfu),GosubIf($[("${SV_DIALSTATUS}"="NOANSWER"|"${SV_DIALSTATUS}"="CHANUNAVAIL") & "${CFUEXT}"!="" & "${SCREEN}"=""]?docfu,1)
exten => s,n(calldocfb),GosubIf($["${SV_DIALSTATUS}"="BUSY" & "${CFBEXT}"!=""]?docfb,1)
exten => s,n,Set(DIALSTATUS=${SV_DIALSTATUS})
exten => s,n,Noop(Voicemail is '${VMBOX}')
exten => s,n,GotoIf($["${VMBOX}"="novm"]?s-${DIALSTATUS},1)
exten => s,n,Noop(Sending to Voicemail box ${EXTTOCALL})
exten => s,n,Macro(vm,${VMBOX},${DIALSTATUS},${IVR_RETVM})
exten => docfu,1(docfu),Set(RTCFU=${IF($["${VMBOX}"!="novm"]?${RINGTIMER}:"")})
exten => docfu,n,Dial(Local/${CFUEXT}@from-internal/n,${RTCFU},${DIAL_OPTIONS})
exten => docfu,n,Return()
exten => docfb,1(docfb),Set(RTCFB=${IF($["${VMBOX}"!="novm"]?${RINGTIMER}:"")})
exten => docfb,n,Dial(Local/${CFBEXT}@from-internal/n,${RTCFB},${DIAL_OPTIONS})
exten => docfb,n,Return()
exten => s-BUSY,1,Noop(Extension is reporting BUSY and not passing to Voicemail)
exten => s-BUSY,n,GotoIf($["${IVR_RETVM}"="RETURN" & "${IVR_CONTEXT}"!=""]?exit,1)
exten => s-BUSY,n,Playtones(busy)
exten => s-BUSY,n,Busy(20)
exten => _s-!,1,Noop(IVR_RETVM: ${IVR_RETVM} IVR_CONTEXT: ${IVR_CONTEXT})
exten => _s-!,n,GotoIf($["${IVR_RETVM}"="RETURN" & "${IVR_CONTEXT}"!=""]?exit,1)
exten => _s-!,n,Playtones(congestion)
exten => _s-!,n,Congestion(10)
exten => exit,1,Playback(beep&line-busy-transfer-menu&silence/1)
exten => exit,n,MacroExit()

; end of [macro-exten-vm]


[macro-simple-dial]
include => macro-simple-dial-custom
exten => s,1,Set(__EXTTOCALL=${ARG1})
exten => s,n,Set(RT=${ARG2})
exten => s,n,Set(CFUEXT=${DB(CFU/${EXTTOCALL})})
exten => s,n,Set(CFBEXT=${DB(CFB/${EXTTOCALL})})
exten => s,n,Set(CWI_TMP=${CWIGNORE})
exten => s,n(macrodial),Macro(dial-one,${RT},${DIAL_OPTIONS},${EXTTOCALL})
exten => s,n,Set(__CWIGNORE=${CWI_TMP})
exten => s,n,Set(PR_DIALSTATUS=${DIALSTATUS})
exten => s,n(calldocfu),GosubIf($["${PR_DIALSTATUS}"="NOANSWER" & "${CFUEXT}"!=""]?docfu,1)
exten => s,n(calldocfb),GosubIf($["${PR_DIALSTATUS}"="BUSY" & "${CFBEXT}"!=""]?docfb,1)
exten => s,n,Set(DIALSTATUS=${PR_DIALSTATUS})
exten => s,n,Goto(s-${DIALSTATUS},1)
exten => docfu,1,GotoIf($["${DB(AMPUSER/${CFUEXT}/device)}" = "" ]?chlocal)
exten => docfu,n,Dial(Local/${CFUEXT}@ext-local,${RT},${DIAL_OPTIONS})
exten => docfu,n,Return()
exten => docfu,n(chlocal),Dial(Local/${CFUEXT}@from-internal/n,${RT},${DIAL_OPTIONS})
exten => docfu,n,Return()
exten => docfb,1,GotoIf($["${DB(AMPUSER/${CFBEXT}/device)}" = "" ]?chlocal)
exten => docfb,n,Dial(Local/${CFBEXT}@ext-local,${RT},${DIAL_OPTIONS})
exten => docfb,n,Return()
exten => docfb,n(chlocal),Dial(Local/${CFBEXT}@from-internal/n,${RT},${DIAL_OPTIONS})
exten => docfb,n,Return()
exten => _s-.,1,Noop(Extension is reporting ${EXTEN})

; end of [macro-simple-dial]


[macro-hangupcall]
include => macro-hangupcall-custom
exten => s,1(start),GotoIf($["${USE_CONFIRMATION}"="" | "${RINGGROUP_INDEX}"="" | "${CHANNEL}"!="${UNIQCHAN}"]?skiprg)
exten => s,n,Noop(Cleaning Up Confirmation Flag: RG/${RINGGROUP_INDEX}/${CHANNEL})
exten => s,n(delrgi),Noop(Deleting: RG/${RINGGROUP_INDEX}/${CHANNEL} ${DB_DELETE(RG/${RINGGROUP_INDEX}/${CHANNEL})})
exten => s,n(skiprg),GotoIf($["${BLKVM_BASE}"="" | "BLKVM/${BLKVM_BASE}/${CHANNEL}"!="${BLKVM_OVERRIDE}"]?skipblkvm)
exten => s,n,Noop(Cleaning Up Block VM Flag: ${BLKVM_OVERRIDE})
exten => s,n(delblkvm),Noop(Deleting: ${BLKVM_OVERRIDE} ${DB_DELETE(${BLKVM_OVERRIDE})})
exten => s,n(skipblkvm),GotoIf($["${FMGRP}"="" | "${FMUNIQUE}"="" | "${CHANNEL}"!="${FMUNIQUE}"]?theend)
exten => s,n(delfmrgp),Noop(Deleting: FM/DND/${FMGRP}/${CHANNEL} ${DB_DELETE(FM/DND/${FMGRP}/${CHANNEL})})
exten => s,n(theend),Hangup

; end of [macro-hangupcall]


[macro-dial-one]
include => macro-dial-one-custom
exten => s,1,Set(DEXTEN=${ARG3})
exten => s,n,Set(DIALSTATUS_CW=)
exten => s,n,GosubIf($["${FROM_DID}"!="" & "${SCREEN}"="" & "${DB(AMPUSER/${DEXTEN}/screen)}"!=""]?screen,1)
exten => s,n,GosubIf($["${DB(CF/${DEXTEN})}"!=""]?cf,1)
exten => s,n,GotoIf($["${DEXTEN:-1}"="#" | "${DB(DND/${DEXTEN})}"=""]?skip1)
exten => s,n,Set(DEXTEN=)
exten => s,n,Set(DIALSTATUS=BUSY)
exten => s,n(skip1),GotoIf($["${DEXTEN}"=""]?nodial)
exten => s,n,GotoIf($["${DEXTEN:-1}"="#"]?continue)
exten => s,n,Set(EXTHASCW=${IF($["${CWIGNORE}"!=""]?"":${DB(CW/${DEXTEN})})})
exten => s,n,GotoIf($["${EXTHASCW}"="" | "${DB(CFB/${DEXTEN})}"!="" | "${DB(CFU/${DEXTEN})}"!=""]?next1:cwinusebusy)
exten => s,n(next1),GotoIf($["${DB(CFU/${DEXTEN})}"!="" & ("${EXTENSION_STATE(${DEXTEN})}"="UNAVAILABLE" | "${EXTENSION_STATE(${DEXTEN})}"="UNKNOWN")]?docfu:skip3)
exten => s,n(docfu),Set(DEXTEN=)
exten => s,n,Set(DIALSTATUS=NOANSWER)
exten => s,n,Goto(nodial)
exten => s,n(skip3),GotoIf($["${EXTHASCW}"="" | "${DB(CFB/${DEXTEN})}"!=""]?next2:continue)
exten => s,n(next2),GotoIf($["${EXTENSION_STATE(${DEXTEN})}"="NOT_INUSE" | "${EXTENSION_STATE(${DEXTEN})}"="UNAVAILABLE" | "${EXTENSION_STATE(${DEXTEN})}"="UNKNOWN"]?continue)
exten => s,n,ExecIf($["${DB(CFB/${DEXTEN})}"!="" & "${CFIGNORE}"=""]?Set(DIALSTATUS=BUSY))
exten => s,n,GotoIf($["${EXTHASCW}"!="" | "${DEXTEN:-1}"="#"]?cwinusebusy)
exten => s,n,Set(DEXTEN=)
exten => s,n,Set(DIALSTATUS=BUSY)
exten => s,n,Goto(nodial)
exten => s,n(cwinusebusy),GotoIf($["${EXTHASCW}"!="" & "${CWINUSEBUSY}"!=""]?next3:continue)
exten => s,n(next3),ExecIf($["${EXTENSION_STATE(${DEXTEN})}"!="UNAVAILABLE" & "${EXTENSION_STATE(${DEXTEN})}"!="NOT_INUSE" & "${EXTENSION_STATE(${DEXTEN})}"!="UNKNOWN"]?Set(DIALSTATUS_CW=BUSY))
exten => s,n(continue),GotoIf($["${DEXTEN}"=""]?nodial)
exten => s,n,GosubIf($["${DEXTEN:-1}"!="#"]?dstring,1:dlocal,1)
exten => s,n,GotoIf($[${LEN(${DSTRING})}=0]?nodial)
exten => s,n,GotoIf($["${DEXTEN:-1}"!="#"]?skiptrace)
exten => s,n,GosubIf($[${REGEX("^[\+]?[0-9]+$" ${CALLERID(number)})} = 1]?ctset,1:ctclear,1)
exten => s,n(skiptrace),Set(D_OPTIONS=${IF($["${NODEST}"!="" & ${REGEX("(M[(]auto-blkvm[)])" ${ARG2})} != 1]?${ARG2}M(auto-blkvm):${ARG2})})
exten => s,n,ExecIf($["${ALERT_INFO}"!=""]?SIPAddHeader(Alert-Info: ${ALERT_INFO}))
exten => s,n,ExecIf($["${SIPADDHEADER}"!=""]?SIPAddHeader(${SIPADDHEADER}))
exten => s,n,ExecIf($["${MOHCLASS}"!=""]?Set(CHANNEL(musicclass)=${MEETME_MUSIC}))
exten => s,n,GosubIf($["${QUEUEWAIT}"!=""]?qwait,1)
exten => s,n,Set(__CWIGNORE=${CWIGNORE})
exten => s,n,Set(__KEEPCID=TRUE)
exten => s,n,Dial(${DSTRING},${ARG1},${D_OPTIONS})
exten => s,n,ExecIf($["${DIALSTATUS_CW}"!=""]?Set(DIALSTATUS=${DIALSTATUS_CW}))
exten => s,n,GosubIf($["${SCREEN}"!=""|"${DIALSTATUS}"="ANSWER"]?s-${DIALSTATUS},1)
exten => s,n,MacroExit()
exten => s,n(nodial),ExecIf($["${DIALSTATUS}" = ""]?Set(DIALSTATUS=NOANSWER))
exten => s,n,Noop(Returned from dial-one with nothing to call and DIALSTATUS: ${DIALSTATUS})
exten => s,n,MacroExit()
exten => h,1,Macro(hangupcall,)
exten => screen,1,GotoIf($["${DB(AMPUSER/${DEXTEN}/screen)}"!="nomemory" | "${CALLERID(number)}"=""]?memory)
exten => screen,n,ExecIf($[${REGEX("^[0-9a-zA-Z ]+$" ${CALLERID(number)})} = 1]?System(rm -f ${ASTVARLIBDIR}/sounds/priv-callerintros/${CALLERID(number)}.*))
exten => screen,n(memory),Set(__SCREEN=${DB(AMPUSER/${DEXTEN}/screen)})
exten => screen,n,Set(__SCREEN_EXTEN=${DEXTEN})
exten => screen,n,Set(ARG2=${ARG2}p)
exten => screen,n,Return()
exten => cf,1,Set(CFAMPUSER=${IF($["${AMPUSER}"=""]?${CALLERID(number)}:${AMPUSER})})
exten => cf,n,ExecIf($["${DB(CF/${DEXTEN})}"="${CFAMPUSER}" | "${DB(CF/${DEXTEN})}"="${REALCALLERIDNUM}" | "${CUT(CUT(BLINDTRANSFER,-,1),/,1)}" = "${DB(CF/${DEXTEN})}" | "${DEXTEN}"="${DB(CF/${DEXTEN})}"]?Return())
exten => cf,n,Set(DEXTEN=${IF($["${CFIGNORE}"=""]?"${DB(CF/${DEXTEN})}#":"")})
exten => cf,n,ExecIf($["${DEXTEN}"!=""]?Return())
exten => cf,n,Set(DIALSTATUS=NOANSWER)
exten => cf,n,Return()
exten => qwait,1,ExecIf($["${SAVEDCIDNAME}" = ""]?Set(__SAVEDCIDNAME=${CALLERID(name)}))
exten => qwait,n,Set(ELAPSED=${MATH($[${EPOCH}+30-${QUEUEWAIT}]/60,int)})
exten => qwait,n,Set(CALLERID(name)=M${ELAPSED}:${SAVEDCIDNAME})
exten => qwait,n,Return()
exten => ctset,1,Set(DB(CALLTRACE/${DEXTEN})=${CALLERID(number)})
exten => ctset,n,Return()
exten => ctclear,1,Noop(Deleting: CALLTRACE/${DEXTEN} ${DB_DELETE(CALLTRACE/${DEXTEN})})
exten => ctclear,n,Return()
exten => dstring,1,Set(DSTRING=)
exten => dstring,n,Set(DEVICES=${DB(AMPUSER/${DEXTEN}/device)})
exten => dstring,n,ExecIf($["${DEVICES}"=""]?Return())
exten => dstring,n,ExecIf($["${DEVICES:0:1}"="&"]?Set(DEVICES=${DEVICES:1}))
exten => dstring,n,Set(LOOPCNT=${FIELDQTY(DEVICES,&)})
exten => dstring,n,Set(ITER=1)
exten => dstring,n(begin),Set(THISDIAL=${DB(DEVICE/${CUT(DEVICES,&,${ITER})}/dial)})
exten => dstring,n,GosubIf($["${ASTCHANDAHDI}" != ""]?zap2dahdi,1)
exten => dstring,n,Set(DSTRING=${DSTRING}${THISDIAL}&)
exten => dstring,n,Set(ITER=$[${ITER}+1])
exten => dstring,n,GotoIf($[${ITER}<=${LOOPCNT}]?begin)
exten => dstring,n,Set(DSTRING=${DSTRING:0:$[${LEN(${DSTRING})}-1]})
exten => dstring,n,Return()
exten => dlocal,1,Set(DSTRING=Local/${DEXTEN:0:${MATH(${LEN(${DEXTEN})}-1,int)}}@from-internal/n)
exten => dlocal,n,Return()
exten => zap2dahdi,1,ExecIf($["${THISDIAL}" = ""]?Return())
exten => zap2dahdi,n,Set(NEWDIAL=)
exten => zap2dahdi,n,Set(LOOPCNT2=${FIELDQTY(THISDIAL,&)})
exten => zap2dahdi,n,Set(ITER2=1)
exten => zap2dahdi,n(begin2),Set(THISPART2=${CUT(THISDIAL,&,${ITER2})})
exten => zap2dahdi,n,ExecIf($["${THISPART2:0:3}" = "ZAP"]?Set(THISPART2=DAHDI${THISPART2:3}))
exten => zap2dahdi,n,Set(NEWDIAL=${NEWDIAL}${THISPART2}&)
exten => zap2dahdi,n,Set(ITER2=$[${ITER2} + 1])
exten => zap2dahdi,n,GotoIf($[${ITER2} <= ${LOOPCNT2}]?begin2)
exten => zap2dahdi,n,Set(THISDIAL=${NEWDIAL:0:$[${LEN(${NEWDIAL})}-1]})
exten => zap2dahdi,n,Return()
exten => s-NOANSWER,1,Macro(vm,${SCREEN_EXTEN},BUSY,${IVR_RETVM})
exten => s-NOANSWER,n,ExecIf($["${IVR_RETVM}"!="RETURN" | "${IVR_CONTEXT}"=""]?Hangup())
exten => s-NOANSWER,n,Return()
exten => s-TORTURE,1,Goto(app-blackhole,musiconhold,1)
exten => s-TORTURE,n,Macro(hangupcall,)
exten => s-DONTCALL,1,Answer
exten => s-DONTCALL,n,Wait(1)
exten => s-DONTCALL,n,Zapateller()
exten => s-DONTCALL,n,Playback(ss-noservice)
exten => s-DONTCALL,n,Macro(hangupcall,)

; end of [macro-dial-one]


[from-internal-additional]
include => from-internal-additional-custom
include => app-callwaiting-cwoff
include => app-callwaiting-cwon
include => app-fmf-toggle
include => ext-findmefollow
include => fmgrps
include => app-dictate-record
include => app-dictate-send
include => vmblast-grp
include => app-dnd-off
include => app-dnd-on
include => app-dnd-toggle
include => ext-meetme
include => app-fax
include => app-gabcast
include => app-recordings
include => app-speeddial
include => app-cf-busy-off
include => app-cf-busy-off-any
include => app-cf-busy-on
include => app-cf-off
include => app-cf-off-any
include => app-cf-on
include => app-cf-unavailable-off
include => app-cf-unavailable-on
include => app-cf-toggle
include => app-pbdirectory
include => app-dialvm
include => app-vmmain
include => ext-group
include => grps
include => ext-queues
include => app-queue-toggle
include => app-languages
include => ext-paging
include => app-blacklist
include => app-calltrace
include => app-directory
include => app-echo-test
include => app-speakextennum
include => app-speakingclock
include => app-userlogonoff
include => app-pickup
include => app-zapbarge
include => app-chanspy
include => ext-test
include => ext-local
include => outbound-allroutes
exten => h,1,Hangup

; end of [from-internal-additional]


